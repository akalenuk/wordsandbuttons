<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<title></title>
	<meta name="description" content="">
	<meta name="keywords" content="mathematics, show-and-tell">
	<link rel="shortcut icon" type="image/x-icon" href="favicon.ico" />
	<style>
body {
	margin: 0 0 0 0;
}

a {
	text-decoration: none;
}

h1 {
	padding-top: 36pt;
	font-size: 24pt;
	width: 600pt;
	text-align: left;
}

h2 {
	padding-top: 20pt;
	font-size: 20pt;
	width: 555pt;
	text-align: left;
}

p {
	line-height: 1.42;
	font-size: 16pt;
	width: 505pt;
	text-align: left;
}

.formula {
	font-family: sans-serif;
	font-size: 15pt;
	font-style: italic;
	text-align: center;
	padding-top: 6pt;
	padding-bottom: 6pt;
}

table.footer {
	padding: 64pt 0pt 32pt 0pt;
	background-color: transparent;
	width: 505pt;
}

td.footer {
	font-family: sans-serif;
	font-size: 16pt;
	font-style: normal;
	padding: 0;
	margin: 0;
	border: 0;
}

li {
	font-size: 16pt;
	width: 505pt;
	text-align: left;
	padding-bottom: 6pt;
}

form {
	margin: 0 0 0 0;
	padding-top: 12pt;
	padding-left: 12pt;
	padding-right: 12pt;
	padding-bottom: 12pt;
	font-size: 16pt;
	text-align: left;
	width: 505pt;
	background-color: #eeee99;
}

input[type="text"] {
	width: 32pt;
	height: 22pt;
	font-size: 16pt;
	text-align: center;
}

button{
	width: 248pt;
	height: 42pt;
	margin-left:4pt;
	margin-right:4pt;
	font-size: 16pt;
}
	</style>
	<script language="JavaScript">
// client
const w = 640.0;
const h = 640.0;

function d2(x1, y1, x2, y2) {
	return (x2-x1)*(x2-x1)+(y2-y1)*(y2-y1);
}

function closest_point_starting_from(x, y, xs, ys, i) {
	for(var j = i + 1; j < xs.length; ++j)
		if(d2(x, y, xs[j], ys[j]) < d2(x, y, xs[i], ys[i]))
			return closest_point_starting_from(x, y, xs, ys, j);
	return i;
}

// finds a closest point from xs, ys to x, y
function closest_point(x, y){
	return closest_point_starting_from(x, y, xs, ys, 0);
}

// points
var xs = [320   , 320 - 128, 320 + 128, 320 + 256, 320 + 128, 320 - 128, 320 - 256];
var ys = [320   , 320 - 256, 320 - 256, 320      , 320 + 256, 320 + 256, 320      ];

var r = 256.;

function draw_arrow(context, x1, y1, x2, y2, color) {
	const d = Math.sqrt(Math.pow(x2-x1, 2) + Math.pow(y2-y1, 2));
	const t = d < 16 ? (d / 16.) : 1.;
	context.beginPath();
	context.moveTo(x1, y1);
	context.lineTo(x2, y2);
	context.moveTo(x2 - ((y2 - y1) * 4.5 / d + (x2 - x1) * 16.5 / d) * t, y2 - ((y2 - y1) * 16.5 / d - (x2 - x1) * 4.5 / d) * t);
	context.lineTo(x2, y2);
	context.moveTo(x2 + ((y2 - y1) * 4.5 / d - (x2 - x1) * 16.5 / d) * t, y2 - ((y2 - y1) * 16.5 / d + (x2 - x1) * 4.5 / d) * t);
	context.lineTo(x2, y2);
	context.strokeStyle = color;
	context.stroke();
	context.closePath();
}

var point_i = 0;
function init_canvas(){
	var canvas = document.getElementById("canvas");
	canvas.addEventListener('mousedown', function(e){
		canvas_rect = canvas.getBoundingClientRect();
		const x = e.clientX - canvas_rect.left;
		const y = e.clientY - canvas_rect.top;
		point_i = closest_point(x, y);
		xs[point_i] = x;
		ys[point_i] = y;
		draw_canvas(0, 0, false);
	}, false);

	canvas.addEventListener('mousemove', function(e){
		canvas_rect = canvas.getBoundingClientRect();
		const x = e.clientX - canvas_rect.left;
		const y = e.clientY - canvas_rect.top;
		if(e.buttons == 1){
			xs[point_i] = x;
			ys[point_i] = y;
			draw_canvas(0, 0, false);
		} else {
			draw_canvas(x, y, true);
		}
	}, false);

	canvas.addEventListener('mouseup', function(e){
		draw_canvas(0, 0, false);
	}, false);

	canvas.addEventListener('mouseleave', function(e){
		draw_canvas(0, 0, false);
	}, false);

	draw_canvas();
}

function lemniscate(x, y) {
	var l = 1.;
	for(var i = 0; i < xs.length; ++i) {
		l *= d2(x, y, xs[i], ys[i]);
	}
	return Math.pow(l, 0.5/xs.length);
}

function draw_canvas(client_x, client_y, do_guides){
	var canvas = document.getElementById("canvas");
	var context = canvas.getContext("2d");

	// draw z-field
	var pixel_field = context.createImageData(w, h);
	for (var i = 0; i < pixel_field.data.length; i += 4) {
		const x = (i / 4) % w;
		const y = (i / 4) / w;
		if(lemniscate(x, y) < r) {
			pixel_field.data[i + 0] = 0;
			pixel_field.data[i + 1] = 0;
			pixel_field.data[i + 2] = 0;
			pixel_field.data[i + 3] = 0xFF;
		} else {
			pixel_field.data[i + 0] = 0xEE;
			pixel_field.data[i + 1] = 0xEE;
			pixel_field.data[i + 2] = 0xEE;
			pixel_field.data[i + 3] = 0xFF;
		}
	}
	context.putImageData(pixel_field, -0.5, -0.5);

	// dots
	context.strokeStyle="#f71134";
	for(var i = 0; i <= xs.length; ++i){
		context.beginPath();
		context.arc(xs[i], ys[i], 4, 0, 2*Math.PI);
		context.stroke();
		context.closePath();
	}

	// guides
	if(do_guides){
		const point_i = closest_point(client_x, client_y);
		draw_arrow(context, xs[point_i], ys[point_i], client_x, client_y);
	}
	context.setLineDash([]);
}

function add_point() {
	xs.push(0.);
	ys.push(0.);
	draw_canvas(0, 0, false);
}

function remove_point() {
	xs.pop();
	ys.pop();
	draw_canvas(0, 0, false);
}
	</script>
</head>
<body>
	<center>
	<h1>
Lemniscate with foci
	</h1>
	<p>
	</p>
	<canvas id="canvas" width=640 height=640></canvas><br>
	<button type="button" id="inc_points" onclick="add_point()">Add a point</button><br>
	<button type="button" id="dec_points" onclick="remove_point()">Remove a point</button>
	<p>
...
	</p>
	<script language="JavaScript">
	init_canvas();
	</script>


	<table class="footer" style="width: 555pt; padding: 64pt 0pt 32pt 0pt; background-color: transparent; font-family: sans-serif; font-size: 16pt; font-style: normal;">
	<tr>
	<td class="footer" style="vertical-align: middle; text-align: left; width: 64px; padding: 0; margin: 0; border: 0;">
		<a href="index.html"><img src="favicon.ico"></a>
	</td>
	<td class="footer" style="vertical-align: middle; text-align: left; width: 200pt; padding: 0; margin: 0; border: 0;">
		&nbsp;&larr; there's more.
	</td>
	<td class="footer" style="vertical-align: middle; text-align: right; width: 300pt; padding: 0; margin: 0; border: 0;">
		+
		<a href="https://github.com/akalenuk/wordsandbuttons">Github</a> &
		<a href="https://twitter.com/wordsandbuttons">Twitter</a> &
		<a href="https://wordsandbuttons.online/rss"><span style="letter-spacing: 1pt;">RSS</span></a>
	</td>
	</tr>
	</table>
	</center>
  </body>
</html>
