<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<title>Biquadratic transformations</title>
	<link rel="shortcut icon" type="image/x-icon" href="favicon.ico" />
	<style>
body {
	margin: 0 0 0 0;
}

a {
	text-decoration: none;
}

h1 {
	padding-top: 36pt;
	font-size: 24pt;
	width: 600pt;
	text-align: left;
}

h2 {
	padding-top: 20pt;
	font-size: 20pt;
	width: 555pt;
	text-align: left;
}

p {
	line-height: 1.42;
	font-size: 16pt;
	width: 505pt;
	text-align: left;
}

pre {
	margin: 0 0 0 0;
	padding-top: 12pt;
	padding-left: 12pt;
	padding-right: 12pt;
	padding-bottom: 12pt;
	font-size: 12pt;
	text-align: left;
	width: 300pt;
}

table {
	border-width: 0pt;
}

td {
	vertical-align: top;
	padding: 6pt 12pt 6pt 12pt;
	font-size: 16pt;
	border: 1px solid black;
	width: 600pt;
}

button {
	width: 248pt;
	height: 42pt;
	margin-left:4pt;
	margin-right:4pt;
	font-size: 16pt;
}

u {
	border-bottom: 1px dotted #000;
	text-decoration: none;
	cursor: pointer;
}
	</style>
	<script language="JavaScript">
// client
var w = 640.0;
var h = 512.0;

// visible region
var x_min = -0.5;
var y_min = -0.5;
var x_max = 2.5;
var y_max = 2.0;

// colors
var line_colors = ["#d64562", "#457fd6", "#62d645"];
var fill_colors = ["#e3bfc3", "#bfc7e3", "#c4e3bf"];

// points
const q_points = [[0., 0.0], [0., 0.5], [0., 1.0], [0.5, 0.0], [0.5, 0.5], [0.5, 1.0], [1., 0.0], [1., 0.5], [1., 1.0]];

var client_x_center = w*(0-x_min)/(x_max-x_min);
var client_x_step = (w/(x_max-x_min));

var client_y_center = h - h*(0-y_min)/(y_max-y_min);
var client_y_step = (h/(y_max-y_min));

function client_to_x(client_x){
	return (client_x - client_x_center) / client_x_step;
}

function client_to_y(client_y){
	return (client_y_center - client_y) / client_y_step;
}

function x_to_client(x){
	return x * client_x_step + client_x_center;
}

function y_to_client(y){
	return client_y_center - y * client_y_step;
}

function draw_grid_on(context){
	context.font = "16px sans-serif";
	// axes
	context.beginPath();
	context.moveTo(0, client_y_center);
	context.lineTo(w, client_y_center);
	context.lineTo(w - 12, client_y_center - 5);
	context.moveTo(w, client_y_center);
	context.lineTo(w - 12, client_y_center + 5);
	context.moveTo(client_x_center, h);
	context.lineTo(client_x_center, 0);
	context.lineTo(client_x_center - 5, 12);
	context.moveTo(client_x_center, 0);
	context.lineTo(client_x_center + 5, 12);
	context.fillStyle="#000000";
	// numbers
	for(var i = Math.floor(x_min) + 1; i <= x_max - 1; i++){
		context.moveTo(client_x_center + i*client_x_step, client_y_center);
		context.lineTo(client_x_center + i*client_x_step, client_y_center - 5);
		context.fillText(i, client_x_center + i*client_x_step + 4, client_y_center + 16);
	}
	for(var i = Math.floor(y_min) + 1; i <= y_max - 1; i++){
		context.moveTo(client_x_center, client_y_center - i*client_y_step);
		context.lineTo(client_x_center + 5, client_y_center - i*client_y_step);
		context.fillText(i, client_x_center + 5, client_y_center - i*client_y_step + 16);
	}
	// letters
	context.fillText("X1", client_x_center + x_max*client_x_step - 24, client_y_center - 16);
	context.fillText("X2", client_x_center - 30, client_y_center - y_max*client_y_step + 16);

	context.strokeStyle="#000000";
	context.stroke();
	context.closePath();
}

function nearest_point(xy, points) {
	function d(xy1, xy2) {
		return (xy1[0] - xy2[0])*(xy1[0] - xy2[0]) + (xy1[1] - xy2[1])*(xy1[1] - xy2[1]);
	}
	var nearest_i = 0;
	var nearest_d = d(xy, points[0]);
	for(var i = 1; i < points.length; ++i) {
		const di = d(xy, points[i]);
		if(di < nearest_d) {
			nearest_d = di;
			nearest_i = i;
		}
	}
	return nearest_i;
}

function set_q_points(xy) {
	const x = client_to_x(Math.max(Math.min(xy[0], w - 1), 0));
	const y = client_to_y(Math.max(Math.min(xy[1], h -1), 0));

	const i = nearest_point([x, y], q_points);
	q_points[i][0] = x;
	q_points[i][1] = y;
}

function init_plot_q(){
	var canvas = document.getElementById("plot_q");

	canvas.addEventListener('mousemove', function(e){
		const canvas_rect = canvas.getBoundingClientRect();
		if(e.buttons == 1){
			const x = e.clientX - canvas_rect.left;
			const y = e.clientY - canvas_rect.top;
			set_q_points([x, y]);
			draw_plot_q();
		}
	}, false);

	canvas.addEventListener('mousedown', function(e){
		const canvas_rect = canvas.getBoundingClientRect();
		const x = e.clientX - canvas_rect.left;
		const y = e.clientY - canvas_rect.top;
		set_q_points([x, y]);
		draw_plot_q();
	}, false);

	canvas.addEventListener('mouseleave', function(e){
		if(e.buttons == 1){
			const canvas_rect = canvas.getBoundingClientRect();
			const x = e.clientX - canvas_rect.left;
			const y = e.clientY - canvas_rect.top;
			set_q_points([x, y]);
		}
		draw_plot_q();
	}, false);

	draw_plot_q();
}

function draw_plot_q() {
	plot = document.getElementById("plot_q");
	var context = plot.getContext("2d");

	// background
	context.fillStyle="#eeeeee";
	context.fillRect(0, 0, w, h);

	// grid
	draw_grid_on(context);

	// points
	context.strokeStyle = line_colors[0];
	for(var i = 0; i < 9; ++i) {
		x = x_to_client(q_points[i][0]);
		y = y_to_client(q_points[i][1]);
		context.beginPath();
		context.arc(x, y, 4, 0, 2*Math.PI);
		context.stroke();
		context.closePath();
	}
}
	</script>
</head>
<body>
	<center>
	<h1>
Biquadratic transformations
	</h1>
	<p>
...
	</p>

	<canvas id="plot_q" width=640 height=512></canvas>

	<p>
...
	</p>
	<script language="JavaScript">
init_plot_q()
	</script>

	<table class="footer" style="width: 555pt; padding: 64pt 0pt 32pt 0pt; background-color: transparent; font-family: sans-serif; font-size: 16pt; font-style: normal;">
	<tr>
	<td class="footer" style="vertical-align: middle; text-align: left; width: 64px; padding: 0; margin: 0; border: 0;">
		<a href="index.html"><img src="favicon.ico"></a> 
	</td>
	<td class="footer" style="vertical-align: middle; text-align: left; width: 200pt; padding: 0; margin: 0; border: 0;">
		&nbsp;&larr; there's more.
	</td>
	<td class="footer" style="vertical-align: middle; text-align: right; width: 300pt; padding: 0; margin: 0; border: 0;">
		+
		<a href="faq.html"><span style="letter-spacing: 1pt;">FAQ</span></a> &
		<a href="https://github.com/akalenuk/wordsandbuttons">Github</a> &
		<a href="https://twitter.com/wordsandbuttons">Twitter</a> &
		<a href="https://wordsandbuttons.online/rss"><span style="letter-spacing: 1pt;">RSS</span></a>
	</td>
	</tr>
	</table>
	</center>
</body>
</html>
