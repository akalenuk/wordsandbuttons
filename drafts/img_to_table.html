<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=0.84">
	<title>?</title>
	<meta name="description" content="?">
	<meta name="keywords" content="demos">
	<link rel="shortcut icon" type="image/x-icon" href="favicon.svg" />
	<style>
body {
	margin: 0 0 0 0;
}

a {
	text-decoration: none;
}

h1 {
	padding-top: 36pt;
	font-size: 24pt;
	width: 600pt;
	text-align: left;
}

h2 {
	padding-top: 20pt;
	font-size: 20pt;
	width: 555pt;
	text-align: left;
}

p {
	line-height: 1.42;
	font-size: 16pt;
	width: 505pt;
	text-align: left;
}

form {
	margin: 0 0 0 0;
	padding-top: 12pt;
	padding-left: 12pt;
	padding-right: 12pt;
	padding-bottom: 12pt;
	font-size: 16pt;
	text-align: left;
	width: 505pt;
	background-color: #eeee99;
	color: #000;
}


button {
	width: 248pt;
	height: 42pt;
	margin-left:4pt;
	margin-right:4pt;
	font-size: 16pt;
}

textarea {
	width: 100%;
	font-size: 12pt;
	font-family: monospace;
}

canvas { touch-action: none; }
	</style>
	<script language="JavaScript">
function load_pixels_from(url) {
	fetch(url).then(function(response) {
		response.blob().then(function(blob) {
			createImageBitmap(blob).then(function(img) {
				const w = img.width;
				const h = img.height;
				var canvas = document.getElementById("the_img");
				var context = canvas.getContext('2d');
				canvas.width = w;
				canvas.height = h;
				context.drawImage(img, 0, 0 );
				var image_data = context.getImageData(0, 0, w, h);
				pixels = [];
				for (var i = 0; i < h; ++i) {
					pixelsi = []
					for (var j = 0; j < w; ++j) {
						pixel = [
							image_data.data[(i*w + j)*4 + 0],
							image_data.data[(i*w + j)*4 + 1],
							image_data.data[(i*w + j)*4 + 2]];
						pixelsi.push(pixel);
					}
					pixels.push(pixelsi);
				}
			});
		});
	});
}


function canvas_to_textarea() {
	const the_canvas = document.getElementById("the_img");
	var the_context = the_canvas.getContext("2d");
	const w = the_canvas.width;
	const h = the_canvas.height;
	var img = the_context.getImageData(0, 0, w, h);
	var opt_bitmap = [];
	for(var i = 0; i < h; ++i) {
		var row = [];
		for(var j = 0; j < w; ++j) {
			var cell = [img.data[(i*w+j)*4], img.data[(i*w+j)*4+1], img.data[(i*w+j)*4+2], 1, 1]; // r,g,b,dw,dh
			row.push(cell)
		}
		opt_bitmap.push(row);
	}
	
	
	
	//var pixel_field = context.createImageData(w, h);
	//for (var i = 0; i < pixel_field.data.length; i += 4) {
	//	if(z_field[Math.floor(i/4)] == Z_NOT_APLICABLE || z_field[Math.floor(i/4)] == Z_NOT_DETERMINED) {
	//		pixel_field.data[i + 0] = 0x00;
	//		pixel_field.data[i + 1] = 0x00;
	//		pixel_field.data[i + 2] = 0x00;
	//		pixel_field.data[i + 3] = 0x00;
	//	} else {
	//		const color = Math.trunc(z_field[Math.floor(i/4)] / 8) * 8;
	//		pixel_field.data[i + 0] = color;
	//		pixel_field.data[i + 1] = color;
	//		pixel_field.data[i + 2] = color;
	//		pixel_field.data[i + 3] = 0xFF;
	//	}
	//}
	//context.putImageData(pixel_field, -0.5, -0.5);
}
/*
def to_html(bitmap):
	opt_bitmap = [[(c, 1, 1) for c in cline] for cline in bitmap]
	W = len(opt_bitmap[0])
	H = len(opt_bitmap)
	for i in range( H ):
		for j in range( W ):
			(c, w, h) = opt_bitmap[i][j]
			if w < 0 or h < 0:
				continue
			dj = W - j
			for jj in range(j+1, W):
				(cj, wj, hj) = opt_bitmap[i][jj]
				if wj < 0 or hj < 0 or cj != c:
					dj = jj - j
					break
			
			di = H - i
			for ii in range(i+1, H):
				for jj in range(j, j + dj):
					(cij, wij, hij) = opt_bitmap[ii][jj]
					if wij < 0 or hij < 0 or cij != c:
						di = ii - i
						break
				if di != H - i:
					break

			if di != 1 or dj != 1:
				for ii in range(i, i+di):
					for jj in range(j, j+dj):
						opt_bitmap[ii][jj] = (c, -1, -1)
			opt_bitmap[i][j] = (c, dj, di)
 

	ret = "<table border=0 cellspacing=0 cellpadding=0 width=" + str(W) + ">\n"
	ret += "<tr height=0>"
	for c in bitmap[0]:
		ret += "<td width=1></td>"
	ret += "</tr>\n"

	for cline in opt_bitmap:
		ret += "<tr height=1>"
		for (c, w, h) in cline:
			if c == "":
				bg = ""
			else:
				bg = " bgcolor=" + c

			if w < 0 or h < 0:
				continue
			elif w > 1 and h > 1:
				ret += "<td" + bg + " colspan=" + str(w) + " rowspan=" + str(h) + "></td>"
			elif w > 1:
				ret += "<td" + bg + " colspan=" + str(w) + "></td>"
			elif h > 1:
				ret += "<td" + bg + " rowspan=" + str(h) + "></td>"
			else:
				ret += "<td" + bg + "></td>"
		ret += "</tr>\n"


	ret += "</table>"
	
	return ret
*/
	</script>
</head>
<body>
	<center>
	<h1>
?
	</h1>
	<form>
	<center>
	<canvas id="the_img" width=640 height=480></canvas>
	<script language="JavaScript">
var the_canvas = document.getElementById("the_img");
var the_context = the_canvas.getContext("2d");

window.addEventListener('paste', function(e) {
	if(e.clipboardData == false) return false;
	var imgs = e.clipboardData.items;
	if(imgs == undefined) return false;
	for (var i = 0; i < imgs.length; i++) {
		if (imgs[i].type.indexOf("image") == -1) continue;
		var imgObj = imgs[i].getAsFile();
		var url = window.URL || window.webkitURL;
		var src = url.createObjectURL(imgObj);
		the_context.clearRect(0,0,the_canvas.width,the_canvas.height);
		loadImage(src);
	}
});

function loadImage(src){
	var img = new Image();
	img.onload = function(e) {
		the_canvas.width = img.width;
		the_canvas.height = img.height;
		the_context.drawImage(img, 0, 0);
	};
	img.src = src;
}
	</script>
	<br />
	<button type="button" style="width: 256pt;" onclick="canvas_to_textarea()">&uarr; canvas to textarea &darr;</button>
	<br />
	<textarea id="the_html" rows=24></textarea>
	</center>
	</form>
	<p>
...
	</p>


	<p>
...
	</p>


	<script language="JavaScript">
load_pixels_from("https://raw.githubusercontent.com/akalenuk/wordsandbuttons/master/pages/img/Philips_PM5544.png");
	</script>

	<table class="footer" style="width: 555pt; padding: 64pt 0pt 32pt 0pt; background-color: transparent; font-family: sans-serif; font-size: 16pt; font-style: normal;">
	<tr>
	<td class="footer" style="vertical-align: middle; text-align: left; width: 64px; padding: 0; margin: 0; border: 0;">
		<a href="index.html">Index</a>
		<a href="all_demos.html">#demos</a>
	</td>
	<td class="footer" style="vertical-align: middle; text-align: left; width: 200pt; padding: 0; margin: 0; border: 0;">
		&nbsp;&larr; there's more.
	</td>
	<td class="footer" style="vertical-align: middle; text-align: right; width: 300pt; padding: 0; margin: 0; border: 0;">
		+
		<a href="https://github.com/akalenuk/wordsandbuttons">Github</a> &
		<a href="https://twitter.com/wordsandbuttons">Twitter</a> &
		<a href="https://wordsandbuttons.online/rss"><span style="letter-spacing: 1pt;">RSS</span></a>
	</td>
	</tr>
	</table>
	</center>
</body>
</html>
