<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<title>Floating point addition</title>
	<style>
body{
	margin: 0 0 0 0;
}

a{
	text-decoration: none;
}

h1 {
	padding-top: 32pt;
	font-size: 24pt;
	width: 600pt;
}

h2 {
	padding-top: 16pt;
	font-size: 20pt;
	width: 555pt;
	text-align: left;
}

p {
	font-size: 16pt;
	width: 505pt;
	text-align: left;
}

.comment {
	font-size: 12pt;
	text-align:center;
	font-family: sans-serif;
	padding-bottom: 24pt;
}

.formula {
	font-family: sans-serif;
	font-size: 15pt;
	font-style: italic;
	text-align: center;
	padding-top: 6pt;
	padding-bottom: 6pt;
}

.footer {
	margin-top: 64pt;
	padding-bottom: 32pt;
	font-family: sans-serif;
	font-size: 16pt;
	text-align: left;
}

table {
	font-family: sans-serif;
	font-size: 13pt;
	font-style: italic;
	width: 505pt;
	text-align: center;
}

th {
	vertical-align: text-top;
	padding-top: 6pt;
	padding-bottom: 6pt;
	font-style: bold;
}

td {
	vertical-align: text-top;
	padding-top: 6pt;
	padding-bottom: 6pt;
}

li {
	font-size: 16pt;
	width: 505pt;
	text-align: left;
	padding-bottom: 6pt;
}

form {
	margin: 0 0 0 0;
	padding-top: 12pt;
	padding-left: 12pt;
	padding-right: 12pt;
	padding-bottom: 12pt;
	font-size: 16pt;
	text-align: left;
	width: 505pt;
	background-color: #eeee99;
}

input[type="text"] {
	width: 32pt;
	height: 22pt;
	font-size: 16pt;
	text-align: center;
}

button {
	width: 32pt;
	height: 26pt;
	font-size: 16pt;
	text-align: center;
}

pre {
	margin: 0 0 0 0;
	padding-top: 12pt;
	padding-left: 12pt;
	padding-right: 12pt;
	padding-bottom: 12pt;
	font-size: 12pt;
	text-align: left;
	width: 505pt;
}

u {
	border-bottom: 1px dotted #000;
	text-decoration: none;
	cursor: pointer;
}

p.big {
	font-size: 84pt;
	margin: -12pt 0 -12pt 0;
	text-align: center;
}
	</style>
	<script language="JavaScript">
const w = 640;
const h = 200;	
const cell_width = 64;	
const cell_height = 64;
const cell_y = 20;

// floating point
floating_cell_xs = [20, 20 + 90 + 43 - 32, 20 + 90*2 + 43 - 32, 20 + 90*3 + 43 - 32, 20 + 90*4 + 43*2, 20 + 90*5 + 43*2];
floating_cell_colors = ["#dba0ac", "#acdba0", "#acdba0", "#acdba0", "#cfa0db", "#cfa0db"];
floating_cell_bits = [[], [0, 0, 0, 1, 1, 0], [0, 0, 0, 1, 1, 0], [0, 0, 1, 0, 1, 0]];

function init_floating(n) {
	var floating = document.getElementById("floating_" + String(n));
	floating_draw(n);
	
	floating.addEventListener('click', function(e){
		var canvas_rect = floating.getBoundingClientRect();
		var x = e.clientX - canvas_rect.left;
		var y = e.clientY - canvas_rect.top;
		for(var i = 0; i < floating_cell_xs.length; ++i) {
			if (x > floating_cell_xs[i] && x < floating_cell_xs[i] + cell_width && y > cell_y && y < cell_y + cell_height)
				floating_cell_bits[n][i] = 1 - floating_cell_bits[n][i];
		}
		floating_draw(n);
	}, false);
}

function floating_draw(n) {
	var floating = document.getElementById("floating_" + String(n));
	var floating_context = floating.getContext("2d");

	// background
	floating_context.fillStyle="#dbd5a0";
	floating_context.fillRect(0, 0, w, h);
	
	// cells
	for(var i = 0; i < floating_cell_xs.length; ++i) {
		floating_context.fillStyle = floating_cell_colors[i];
		floating_context.fillRect(floating_cell_xs[i], cell_y, cell_width, cell_height);
		
		floating_context.textAlign = "center";
		floating_context.textBaseline = "middle"; 
		floating_context.font = "48px sans-serif";
		floating_context.fillStyle = "#222222";
		floating_context.fillText(floating_cell_bits[n][i], floating_cell_xs[i] + cell_width / 2.0, cell_y + cell_height / 2.0 + 4);
	}
	
	// the number
	var sign = floating_cell_bits[n][0] ? -1.0 : 1.0;
	var e = floating_cell_bits[n][3] + floating_cell_bits[n][2] * 2 + floating_cell_bits[n][1] * 4;
	var n = floating_cell_bits[n][5] + floating_cell_bits[n][4] * 2 + ((e != 0 && e != 7) ? 4 : 0);
	
	// explicit point
	if (e != 0 && e != 7) {
		floating_context.fillStyle = "#673670";
		floating_context.fillText("1", 420, cell_y + cell_height / 2.0 + 4);
	}
	
	// comment
	floating_context.textAlign = "left";
	floating_context.textBaseline = "alphabetic"; 
	floating_context.font = "20px sans-serif";
			
	if( e == 7 ) {
		if ( n == 0 ) {
			floating_context.fillStyle = "#914853";
			floating_context.fillText(sign == -1.0 ? "Negative" : "Positive", 20, 120);
			floating_context.fillStyle = "#673670";
			floating_context.fillText("infinite number.", 20, 145);
		} else {
			floating_context.fillStyle = "#673670";
			floating_context.fillText("Not a number.", 20, 120);
		}
	} else {
		floating_context.fillStyle = "#914853";
		floating_context.fillText(sign == -1.0 ? "Negative number" : "Positive number", 20, 120);
		
		floating_context.fillStyle = "#673670"
		floating_context.fillText("of " + n, 20, 145);
		floating_context.fillStyle = "#597052";
		var measures = "quarters,";
		if(e == 2)
			measures = "halves,";
		if(e == 3)
			measures = "wholes,";
		if(e == 4)
			measures = "pairs,";
		if(e == 5)
			measures = "four-packs,";
		if(e == 6)
			measures = "eight-packs,";
		floating_context.fillText(measures, 64, 145);
		
		floating_context.fillStyle = "#673670"
		floating_context.fillText("which is " + sign * (n * Math.pow(2, e - 2 - (e > 0 ? 1 : 0))).toFixed(2) + " in real numbers", 20, 170);
	}
}
	</script>
</head>
<body>
	<center>
	<h1>
6-bit floating point number
	</h1>
	<p>
...
	</p>
	<canvas id="floating_1" width=640 height=200></canvas>
	<script language="JavaScript">
		init_floating(1);
	</script>
	<p class="big">
+
	</p>
	<canvas id="floating_2" width=640 height=200></canvas>
	<script language="JavaScript">
		init_floating(2);
	</script>
	<p class="big">
=
	</p>
	<canvas id="floating_3" width=640 height=200></canvas>
	<script language="JavaScript">
		init_floating(3);
	</script>


	</center>
</body>
</html>
