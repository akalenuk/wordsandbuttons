<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Estimating floating point error the easy way</title>
    <meta name="keywords" content="programming,floating point,fixed point,error,learning">
    <link rel="shortcut icon" type="image/x-icon" href="favicon.ico" />
    <style>
body{
    margin: 0 0 0 0;
}

a{
    text-decoration: none;
}

h1 {
    padding-top: 32pt;
    font-size: 24pt;
    width: 600pt;
    text-align: left;
}

h2 {
    padding-top: 16pt;
    font-size: 20pt;
    width: 555pt;
    text-align: left;
}

p {
    font-size: 16pt;
    width: 505pt;
    text-align: left;
}

.comment {
    font-size: 12pt;
    text-align:center;
    font-family: sans-serif;
    padding-bottom: 24pt;
}

.formula {
    font-family: sans-serif;
    font-size: 15pt;
    font-style: italic;
    text-align: center;
    padding-top: 6pt;
    padding-bottom: 6pt;
}

.footer {
    margin-top: 64pt;
    padding-bottom: 32pt;
    font-family: sans-serif;
    font-size: 16pt;
    text-align: left;
}

table {
    font-family: sans-serif;
    font-size: 13pt;
    font-style: italic;
    width: 505pt;
    text-align: center;
}

th {
    vertical-align: text-top;
    padding-top: 6pt;
    padding-bottom: 6pt;
    font-style: bold;
}

td {
    vertical-align: text-top;
    padding-top: 6pt;
    padding-bottom: 6pt;
}

li {
    font-size: 16pt;
    width: 505pt;
    text-align: left;
    padding-bottom: 6pt;
}

form {
    margin: 0 0 0 0;
    padding-top: 12pt;
    padding-left: 12pt;
    padding-right: 12pt;
    padding-bottom: 12pt;
    font-size: 16pt;
    text-align: left;
    width: 505pt;
    background-color: #eeee99;
}

input[type="text"] {
    width: 32pt;
    height: 22pt;
    font-size: 16pt;
    text-align: center;
}

button {
    width: 32pt;
    height: 26pt;
    font-size: 16pt;
    text-align: center;
}

pre {
    margin: 0 0 0 0;
    padding-top: 12pt;
    padding-left: 12pt;
    padding-right: 12pt;
    padding-bottom: 12pt;
    font-size: 12pt;
    text-align: left;
    width: 505pt;
}

u {
    border-bottom: 1px dotted #000;
    text-decoration: none;
    cursor: pointer;
}
    </style>
    <script language="JavaScript">
const w = 640;
const h = 200;    
const cell_width = 64;    
const cell_height = 64;
const cell_y = 20;
    
// fixed point
fixed_cell_xs = [20, 20 + 90 + 43, 20 + 90*2 + 43, 20 + 90*3 + 43, 20 + 90*4 + 43*2, 20 + 90*5 + 43*2];
fixed_cell_colors = ["#dba0ac", "#cfa0db", "#cfa0db", "#cfa0db", "#cfa0db", "#cfa0db"];
fixed_cell_bits = [0, 0, 0, 1, 1, 0];

function init_fixed() {
    var fixed = document.getElementById("fixed");
    fixed_draw();
    
    fixed.addEventListener('click', function(e){
        var canvas_rect = fixed.getBoundingClientRect();
        var x = e.clientX - canvas_rect.left;
        var y = e.clientY - canvas_rect.top;
        for(var i = 0; i < fixed_cell_xs.length; ++i) {
            if (x > fixed_cell_xs[i] && x < fixed_cell_xs[i] + cell_width && y > cell_y && y < cell_y + cell_height)
                fixed_cell_bits[i] = 1 - fixed_cell_bits[i];
        }
        fixed_draw();
    }, false);
}

function fixed_draw() {
    var fixed = document.getElementById("fixed");
    var fixed_context = fixed.getContext("2d");

    // background
    fixed_context.fillStyle="#dbd5a0";
    fixed_context.fillRect(0, 0, w, h);
    
    // cells
    for(var i = 0; i < fixed_cell_xs.length; ++i) {
        fixed_context.fillStyle = fixed_cell_colors[i];
        fixed_context.fillRect(fixed_cell_xs[i], cell_y, cell_width, cell_height);
        
        fixed_context.textAlign = "center";
        fixed_context.textBaseline = "middle"; 
        fixed_context.font = "48px sans-serif";
        fixed_context.fillStyle = "#222222";        
        fixed_context.fillText(fixed_cell_bits[i], fixed_cell_xs[i] + cell_width / 2.0, cell_y + cell_height / 2.0 + 4);
    }
    
    // the number
    var sign = fixed_cell_bits[0] ? -1.0 : 1.0;    
    var n = fixed_cell_bits[5] + 2*fixed_cell_bits[4] + 4*fixed_cell_bits[3] + 8*fixed_cell_bits[2] + 16*fixed_cell_bits[1];
    
    // explicit point
    fixed_context.fillStyle = "#597052";
    fixed_context.fillText(".", 430, cell_y + cell_height / 2.0 + 4);
    
    // comment
    fixed_context.fillStyle = "#914853"
    fixed_context.textAlign = "left";
    fixed_context.textBaseline = "alphabetic"; 
    fixed_context.font = "20px sans-serif";
    fixed_context.fillText(sign == -1.0 ? "Negative number" : "Positive number", 20, 120);

    fixed_context.fillStyle = "#673670"
    fixed_context.fillText("of " + n + " quarters,", 20, 145);
    fixed_context.fillText("which is " + sign * (n / 4.0).toFixed(2) + " in real numbers.", 20, 170);
}

// floating point
floating_cell_xs = [20, 20 + 90 + 43 - 32, 20 + 90*2 + 43 - 32, 20 + 90*3 + 43 - 32, 20 + 90*4 + 43*2, 20 + 90*5 + 43*2];
floating_cell_colors = ["#dba0ac", "#acdba0", "#acdba0", "#acdba0", "#cfa0db", "#cfa0db"];
floating_cell_bits = [0, 0, 0, 1, 1, 0];

function init_floating() {
    var floating = document.getElementById("floating");
    floating_draw();
    
    floating.addEventListener('click', function(e){
        var canvas_rect = floating.getBoundingClientRect();
        var x = e.clientX - canvas_rect.left;
        var y = e.clientY - canvas_rect.top;
        for(var i = 0; i < floating_cell_xs.length; ++i) {
            if (x > floating_cell_xs[i] && x < floating_cell_xs[i] + cell_width && y > cell_y && y < cell_y + cell_height)
                floating_cell_bits[i] = 1 - floating_cell_bits[i];
        }
        floating_draw();
    }, false);
}

function floating_draw() {
    var floating = document.getElementById("floating");
    var floating_context = floating.getContext("2d");

    // background
    floating_context.fillStyle="#dbd5a0";
    floating_context.fillRect(0, 0, w, h);
    
    // cells
    for(var i = 0; i < floating_cell_xs.length; ++i) {
        floating_context.fillStyle = floating_cell_colors[i];
        floating_context.fillRect(floating_cell_xs[i], cell_y, cell_width, cell_height);
        
        floating_context.textAlign = "center";
        floating_context.textBaseline = "middle"; 
        floating_context.font = "48px sans-serif";
        floating_context.fillStyle = "#222222";        
        floating_context.fillText(floating_cell_bits[i], floating_cell_xs[i] + cell_width / 2.0, cell_y + cell_height / 2.0 + 4);
    }
    
    // the number
    var sign = floating_cell_bits[0] ? -1.0 : 1.0;
    var e = floating_cell_bits[3] + floating_cell_bits[2] * 2 + floating_cell_bits[1] * 4;
    var n = floating_cell_bits[5] + floating_cell_bits[4] * 2 + ((e != 0 && e != 7) ? 4 : 0);
    
    // explicit point
    if (e != 0 && e != 7) {
        floating_context.fillStyle = "#673670";
        floating_context.fillText("1", 420, cell_y + cell_height / 2.0 + 4);    
    }
    
    // comment
    floating_context.textAlign = "left";
    floating_context.textBaseline = "alphabetic"; 
    floating_context.font = "20px sans-serif";
            
    if( e == 7 ) {
        if ( n == 0 ) {
            floating_context.fillStyle = "#914853";
            floating_context.fillText(sign == -1.0 ? "Negative" : "Positive", 20, 120);
            floating_context.fillStyle = "#673670";
            floating_context.fillText("infinite number.", 20, 145);
        } else {
            floating_context.fillStyle = "#673670";
            floating_context.fillText("Not a number.", 20, 120);
        }
    } else {
        floating_context.fillStyle = "#914853";
        floating_context.fillText(sign == -1.0 ? "Negative number" : "Positive number", 20, 120);
        
        floating_context.fillStyle = "#673670"
        floating_context.fillText("of " + n, 20, 145);
        floating_context.fillStyle = "#597052";
        var measures = "quarters,";
        if(e == 2)
            measures = "halves,";
        if(e == 3)
            measures = "wholes,";
        if(e == 4)
            measures = "pairs,";
        if(e == 5)
            measures = "four-packs,";
        if(e == 6)
            measures = "eight-packs,";
        floating_context.fillText(measures, 64, 145);
        
        floating_context.fillStyle = "#673670"
        floating_context.fillText("which is " + sign * (n * Math.pow(2, e - 2 - (e > 0 ? 1 : 0))).toFixed(2) + " in real numbers", 20, 170);
    }
}


// tri-float to RGB
function as_XX(x) {
    return ((x < 16) ? "0" : "") +x.toString(16);
}

function as_RRGGBB(r_01, g_01, b_01) {
    var rgb = [r_01, g_01, b_01];
    var RRGGBB = "#";
    for(var i = 0; i < 3; ++i) {
        if (rgb[i] < 0.0)
            rgb[i] = 0.0;
        if (rgb[i] > 255.0/256.0)
            rgb[i] = 255.0/256;
        RRGGBB += as_XX(Math.trunc(rgb[i] * 256.0));
    }
    return RRGGBB;
}

// tables
const real_relative_error = [[ // changes from e-16 to e+12
[2.71419e-15,	5.38314e-13,	6.5242e-09,	0.000169976,	-1,	-1,	8602.69,	-1,	8.60319e+07,	150.012,	8.60319e+11], 
[1.58974e-14,	2.41692e-14,	6.98051e-11,	2.24224e-07,	0.000139953,	99.5,	12067.2,	99.481,	-1,	-1,	8.60319e+11], 
[1.10001e-09,	3.10128e-12,	2.19267e-12,	3.41006e-10,	7.69563e-05,	0.571096,	1396.31,	9999.48,	8.60219e+07,	-1,	8.60319e+11], 
[2.23409e-05,	1.66495e-07,	2.09845e-09,	2.01095e-10,	3.60296e-07,	0.00103687,	81.6212,	216675,	8.50319e+07,	999718,	1.49012e+12], 
[0.282488,	0.000778791,	1.51221e-05,	2.12163e-07,	1.33514e-08,	4.87671e-05,	0.191829,	4412.1,	4.90116e+07,	9.99999e+07,	9.99832e+07], 
[-1,	2.246,	0.105502,	0.000878104,	4.52363e-06,	8.27404e-08,	0.00495595,	6.67525,	811212,	2.16675e+09,	9.99998e+09], 
[0.999894,	11321.4,	2174.62,	27.6724,	0.0369304,	0.00225589,	0.000159955,	0.472493,	4322.34,	7.10935e+06,	1e+12], 
[0.982698,	149.476,	-1,	95104.5,	1668.32,	34.8341,	0.17236,	0.0186341,	65.0284,	61691.8,	7.10945e+08], 
[0.611949,	148.012,	-1,	1.5e+06,	9.5105e+06,	57231.1,	243.472,	2.16415,	1,	446.035,	6.78253e+07], 
[150.012,	73.5058,	14825.7,	5.73396e+09,	5.58546e+09,	9.5105e+08,	5.72316e+06,	85161.1,	1,	1,	438689], 
[-1,	-1,	-1,	-1,	5.73396e+11,	-1,	9.51051e+10,	5.72319e+08,	1.94836e+07,	9537.74,	1]
], 
[
[1.45403e-13,	7.62557e-15,	1.70158e-11,	7.73242e-07,	0.000211788,	24.5,	24.4998,	-1,	23.4472,	-1,	4.30159e+11], 
[3.44659e-15,	4.41163e-16,	9.41332e-13,	1.56784e-08,	0.000169976,	0.5,	0.499997,	8602.69,	1.21667e+06,	1,	8.60319e+09], 
[2.19568e-11,	2.97454e-13,	1.15805e-14,	4.1495e-11,	2.24306e-07,	0.000139971,	22.1675,	12067.2,	-1,	8.60318e+07,	8.60319e+09], 
[2.18261e-07,	3.8362e-09,	1.40703e-11,	5.17815e-13,	2.7815e-09,	2.91486e-06,	0.201016,	1396.31,	9999.48,	-1,	1.49012e+10], 
[0.00189746,	5.89285e-06,	1.66441e-07,	9.2675e-11,	1.67534e-10,	3.39144e-07,	0.0010366,	29.3984,	999999,	-1,	999831], 
[-1,	0.188884,	0.000778794,	4.18052e-06,	1.27149e-07,	2.82819e-08,	1.48387e-05,	0.192005,	711.448,	1e+08,	9.99998e+07], 
[-1,	1,	2.246,	0.215156,	0.000878859,	2.63728e-05,	3.63545e-06,	0.0050128,	67.3242,	298983,	1e+10], 
[270356,	8110.16,	149.5,	175.1,	5.74201,	0.0369361,	0.004649,	0.000283424,	0.452848,	617.908,	7.10945e+06], 
[16.0742,	-1,	-1,	14999.5,	95104.6,	571.822,	19.9873,	0.080319,	0.00117177,	45.1936,	678252], 
[25.8353,	-1,	5.73544e+07,	14997.8,	5.58546e+07,	1.746e+06,	166882,	243.379,	21.3517,	1,	4385.9], 
[-1,	-1,	-1,	-1,	5.73396e+09,	-1,	9.51051e+08,	5.72319e+06,	194837,	96.3674,	1]
], 
[
[4.60385e-10,	1.2484e-12,	9.83699e-13,	2.23836e-09,	8.96031e-05,	0.240622,	-1,	2499.49,	-1,	-1,	9537.74], 
[6.30725e-13,	5.45939e-14,	9.5953e-15,	1.28909e-10,	3.95771e-07,	0.000211803,	-1,	-1,	-1,	23.5869,	96.3674], 
[7.51356e-14,	4.41163e-15,	1.48231e-15,	5.25796e-13,	8.75301e-10,	2.19749e-05,	0.5,	0.499999,	-1,	-1,	8.60319e+07], 
[3.86181e-10,	2.25214e-11,	3.68671e-13,	2.43522e-14,	7.93903e-12,	9.68419e-07,	0.00013996,	-1,	99.4997,	860219,	96.2748], 
[7.47487e-06,	2.18234e-07,	2.19022e-09,	2.46931e-12,	2.46931e-12,	6.52156e-09,	3.99208e-05,	0.169072,	2167.25,	850319,	-1], 
[0.189858,	0.00149387,	3.87891e-05,	5.65391e-08,	8.22666e-11,	3.61823e-10,	4.01078e-08,	0.0010383,	29.3984,	216675,	-1], 
[1037.55,	10.8705,	0.188884,	0.000321376,	1.77326e-05,	2.24849e-07,	2.52476e-09,	2.39854e-05,	0.191961,	711.443,	1.39681e+07], 
[268706,	2687.55,	-1,	2.246,	0.113807,	0.00131365,	3.97651e-06,	3.38536e-07,	0.0097865,	6.69224,	669072], 
[1665.68,	-1,	8110.16,	-1,	1222.83,	16.7069,	0.182314,	0.00115654,	7.61449e-06,	0.698732,	14182], 
[1613.29,	1.91182e+07,	0.981854,	-1,	558546,	95104.5,	524.701,	9.00937,	0.147389,	0.0165234,	42.869], 
[-1,	-1,	-1,	-1,	5.73396e+07,	1.5e+06,	3.52908e+07,	162070,	851.677,	21.8882,	1]
], 
[
[1.84823e-06,	1.95134e-08,	9.94513e-11,	6.99553e-11,	4.6438e-07,	0.00363939,	62.4518,	249999,	-1,	249891,	4.30159e+11], 
[7.58722e-09,	7.72673e-10,	3.90595e-12,	5.17815e-13,	5.80538e-09,	5.84593e-05,	0.129518,	2499.5,	-1,	2498.67,	4.30159e+09], 
[2.4627e-10,	2.9205e-13,	2.77403e-14,	1.07997e-14,	2.15513e-11,	7.73299e-07,	0.000211787,	36.3337,	4277.09,	-1,	4.30159e+07], 
[2.47803e-11,	5.17925e-13,	6.21157e-15,	1.89735e-15,	5.31666e-13,	8.27438e-09,	5.20425e-05,	0.5,	85.5319,	0.499802,	860318], 
[2.67778e-07,	2.53832e-09,	2.29969e-11,	3.06152e-13,	4.07931e-14,	6.55116e-12,	5.96112e-07,	0.00729845,	22.1675,	-1,	-1], 
[0.00157421,	3.49113e-06,	2.18204e-07,	2.19036e-09,	1.0992e-11,	4.55107e-12,	6.36169e-09,	2.93565e-06,	0.571095,	1396.31,	-1], 
[24.3128,	0.248889,	0.000766943,	1.05548e-05,	5.35417e-08,	3.37741e-09,	3.31965e-11,	7.52858e-07,	0.00636738,	29.3984,	490117], 
[103706,	1666.17,	16.1667,	1,	0.00142157,	2.61005e-05,	2.02272e-09,	1.11177e-08,	1.33403e-05,	0.178235,	4412.11], 
[166666,	1666.16,	-1,	-1,	12.7233,	0.215157,	0.00197261,	6.35535e-06,	1.69873e-06,	0.0022521,	30.3187], 
[1.91165e+09,	2.70356e+07,	16.1612,	-1,	-1,	950.551,	16.1883,	0.0727346,	0.00370836,	0.000165939,	0.446869], 
[158945,	1588.46,	2.70372e+07,	0.983643,	810967,	-1,	17460.5,	524.701,	1.93732,	0.153946,	0.0108948]
], 
[
[0.00164732,	0.000312306,	3.46979e-06,	1.76882e-08,	4.67781e-09,	1.65706e-05,	0.095408,	1107.58,	-1,	-1,	2.49863e+07], 
[0.000260647,	1.84821e-06,	3.56209e-08,	1.45849e-10,	1.79411e-10,	9.38426e-08,	0.00363948,	48.5738,	249999,	-1,	249862], 
[3.96129e-06,	6.29689e-09,	7.72903e-10,	8.4068e-14,	1.60195e-12,	1.7476e-09,	5.8466e-05,	0.240622,	2499.5,	-1,	2498.58], 
[2.78075e-08,	1.81989e-10,	1.00006e-12,	1.91091e-14,	6.09864e-15,	1.76534e-11,	7.37084e-07,	0.0115379,	18.5159,	24.4999,	24.5013], 
[3.9958e-09,	5.93894e-12,	4.21822e-13,	5.42101e-15,	1.38778e-15,	9.3172e-13,	6.52369e-09,	2.19746e-05,	0.360319,	-1,	-1], 
[2.91531e-05,	2.6883e-07,	4.35837e-10,	8.50376e-13,	2.13371e-14,	8.67362e-16,	3.21734e-11,	5.96061e-07,	0.00757891,	13.4681,	8503.69], 
[0.109122,	0.000618965,	1.44641e-05,	1.2092e-07,	2.7436e-09,	2.3306e-12,	9.09516e-13,	2.70666e-09,	7.69496e-05,	0.571094,	1396.31], 
[188.917,	2.38416,	0.299526,	0.00262415,	2.70022e-05,	5.35474e-08,	2.29556e-09,	2.03727e-10,	3.61819e-07,	0.00473505,	66.4074], 
[-1,	103706,	-1,	10.8705,	0.147092,	0.000321389,	1.77426e-05,	9.31323e-10,	2.42144e-08,	4.86374e-05,	0.191856], 
[1.66666e+07,	2.68706e+07,	1666.16,	-1,	56.3546,	2.246,	0.105502,	0.000218838,	1.88351e-05,	9.53674e-07,	0.00493622], 
[-1,	-1,	1665.7,	16.1598,	5734.46,	7961.67,	950.55,	5.2232,	0.0726929,	0.000976562,	0.000167847]
], 
[
[0.25,	0.005805,	0.000276251,	1.81239e-05,	4.0806e-06,	2.13771e-06,	0.000799443,	2.9563,	110708,	2.5e+09,	2.5e+09], 
[2.60481,	0.0472209,	0.000312309,	2.01836e-06,	1.71797e-08,	5.02476e-09,	1.62597e-05,	0.64473,	1107.58,	-1,	2.5e+07], 
[0.000593887,	0.000260647,	1.84822e-06,	2.18724e-08,	1.67534e-10,	2.87557e-11,	2.93847e-07,	6.15071e-05,	11.5707,	-1,	-1], 
[0.000236025,	2.58999e-06,	2.01978e-08,	3.6232e-10,	3.87738e-13,	1.10182e-13,	5.78859e-09,	2.1453e-05,	0.240622,	-1,	427660], 
[6.57408e-07,	5.26356e-10,	2.67304e-10,	1.59052e-12,	1.85615e-14,	1.19696e-14,	9.1461e-11,	7.37033e-07,	0.00356473,	24.5,	4277.09], 
[4.52815e-07,	1.32402e-09,	4.52592e-11,	4.80302e-13,	4.62593e-15,	0,	9.37916e-13,	8.74934e-10,	9.59807e-05,	0.360319,	-1], 
[0.00196,	1.54778e-05,	4.95817e-08,	4.12153e-10,	9.09458e-13,	1.56319e-13,	1.42109e-16,	4.18368e-11,	1.47731e-07,	0.00357933,	13.4681], 
[5.26856,	0.109089,	0.00281189,	3.49145e-06,	3.31277e-07,	5.46606e-10,	2.72848e-12,	0,	2.79397e-09,	3.99202e-05,	0.539181], 
[90813,	907.633,	8.58133,	0.139191,	0.000766941,	5.89294e-06,	5.3551e-08,	1.16415e-09,	2.32831e-10,	3.72529e-07,	0.00636673], 
[1.66667e+09,	1.66667e+07,	24515.8,	1666.17,	16.1667,	0.147092,	0.000321381,	6.76513e-06,	2.23517e-07,	4.47035e-16,	9.72748e-05], 
[2.68706e+11,	2.68706e+09,	1.89515e+07,	1666.16,	16.1666,	80.1116,	2.246,	0.223463,	0.00131321,	1.90735e-05,	1.90735e-06]
], 
[
[2027.54,	1953.29,	48.9195,	3.92914,	0.0288304,	0.000124262,	0.000266371,	0.672582,	4045.6,	1.10708e+07,	2.5e+11], 
[1319.03,	20.0279,	1.373,	0.000275773,	0.000393203,	8.27404e-08,	7.93283e-07,	0.00283001,	2.9523,	110708,	2.5e+09], 
[21.4642,	0.280358,	0.0472209,	3.63361e-05,	2.02047e-06,	1.16861e-08,	2.52476e-09,	1.69419e-05,	0.0953365,	2593.28,	2.5e+07], 
[1.27697,	0.000593931,	0.00015681,	5.96021e-06,	2.18824e-08,	3.31965e-11,	3.31965e-11,	6.43719e-07,	0.00733887,	11.5708,	180160], 
[0.000941552,	3.79784e-05,	6.70263e-06,	3.41392e-08,	4.88285e-11,	5.54244e-13,	9.09516e-13,	5.34419e-09,	5.84687e-05,	0.610709,	2499.5], 
[0.000207324,	5.56436e-07,	1.16861e-08,	3.17414e-10,	6.7261e-13,	1.77636e-14,	7.10543e-16,	1.81899e-11,	3.59549e-07,	0.00734183,	18.5159], 
[2.95232e-05,	1.54107e-07,	2.52476e-09,	1.41731e-11,	3.79326e-14,	2.84217e-16,	1.42109e-16,	2.36469e-13,	8.74279e-10,	9.59808e-05,	0.5], 
[0.136868,	0.00137482,	1.51936e-05,	4.95153e-08,	1.82748e-09,	1.09139e-11,	1.90994e-13,	1.81899e-16,	8.14907e-12,	2.24113e-07,	0.00385935], 
[1574.55,	27.6149,	0.000512081,	0.00157408,	7.47681e-06,	2.18201e-07,	5.47152e-10,	2.09548e-11,	2.32831e-12,	6.4075e-09,	2.91824e-06], 
[1.88418e+06,	18842.3,	907.631,	8.5813,	0.139191,	0.00149386,	1.05549e-05,	5.64009e-08,	1.04308e-09,	1.98682e-16,	7.43866e-07], 
[2.45153e+10,	2.45153e+08,	2.45153e+06,	-1,	245.653,	2.95153,	0.188884,	0.00187898,	6.77109e-06,	1.90735e-14,	3.8147e-08]
], 
[
[-1,	-1,	195280,	47552,	204.846,	2.43245,	0.0140866,	0.00865078,	53.3869,	335575,	2.59378e+09], 
[32.8302,	0.249941,	74.5,	87.7998,	1.18786,	0.0122433,	0.000306161,	0.000101525,	1.03492,	3356,	2.59378e+07], 
[3332.83,	-1,	0.25,	1.38695,	0.000276143,	0.000291832,	1.25308e-06,	1.24803e-06,	0.00798206,	39.9633,	259377], 
[16293.4,	162.439,	4.15604,	0.0472209,	0.000101645,	2.09613e-06,	1.84409e-08,	1.11177e-08,	1.68327e-05,	0.0953505,	1107.58], 
[78.1979,	1.27697,	0.0131146,	0.000121494,	2.26371e-06,	8.07086e-09,	2.18279e-11,	6.91216e-11,	1.05705e-07,	0.00733861,	11.5708], 
[1.11066,	0.000974711,	9.94027e-05,	2.58954e-06,	3.4143e-08,	7.72843e-10,	2.27374e-13,	9.09495e-13,	1.62981e-09,	2.14428e-05,	0.129519], 
[0.00107165,	0.000368381,	4.27968e-06,	4.04204e-08,	3.4197e-10,	3.4864e-12,	5.45697e-14,	9.09495e-15,	5.93718e-11,	1.80304e-08,	0.000211792], 
[0.000444172,	4.08919e-05,	2.67794e-07,	1.00893e-09,	2.18279e-11,	7.27596e-16,	6.0633e-15,	1.81899e-16,	2.44472e-13,	1.39236e-08,	5.20422e-05], 
[8.70128,	0.249524,	0.00135056,	4.12203e-06,	4.74975e-08,	1.47459e-09,	1.16415e-11,	1.5134e-13,	2.32831e-14,	3.27826e-11,	5.96046e-07], 
[157432,	477.34,	5.2667,	0.109109,	0.000618935,	1.44616e-05,	1.20898e-07,	1.09971e-09,	1.04308e-11,	0,	6.29425e-09], 
[9.08133e+08,	9.08133e+06,	18842.4,	907.629,	8.58131,	0.139191,	0.000363506,	1.05548e-05,	5.35011e-08,	1.90735e-14,	5.72205e-16]
], 
[
[2.02779e+07,	2.02778e+07,	2.02704e+07,	749999,	494195,	6879.11,	193.667,	0.126885,	1.32831,	1789.14,	4.04549e+07], 
[-1,	-1,	-1,	-1,	4941.45,	69.2863,	0.309672,	0.00117177,	0.00117177,	18.1363,	404548], 
[-1,	-1,	2027.54,	74.5,	48.9195,	1.55348,	0.012216,	7.61449e-06,	0.00012403,	0.065433,	3356.98], 
[-1,	-1,	1319.03,	0.25,	0.005805,	0.000275952,	0.000393436,	1.40769e-06,	6.29574e-07,	0.00806355,	39.9508], 
[219642,	24335.9,	21.4642,	2.93354,	0.036773,	0.000239639,	6.48084e-07,	7.79983e-09,	9.31323e-10,	1.7345e-05,	1.01492], 
[19642.5,	352.322,	1.4643,	0.000593865,	1.76612e-05,	2.2637e-06,	2.18861e-08,	5.82077e-11,	1.16415e-10,	1.04308e-07,	0.00363922], 
[61.73,	1.63099,	0.0264187,	9.92936e-05,	1.48468e-07,	2.01981e-08,	3.62052e-10,	1.16415e-12,	0,	8.9407e-09,	8.95977e-05], 
[0.358179,	0.000768488,	5.05932e-05,	1.79373e-06,	1.06326e-08,	3.88051e-11,	3.49246e-12,	2.32831e-14,	6.98492e-16,	5.88596e-11,	1.11475e-06], 
[0.164153,	0.00117177,	3.11906e-05,	5.34579e-07,	6.8297e-09,	2.32831e-16,	3.88051e-13,	2.32831e-16,	1.16415e-16,	9.23872e-13,	8.73566e-10], 
[2310.68,	2.24176,	0.142422,	0.000836492,	1.83384e-05,	4.7187e-08,	7.45058e-10,	9.93411e-13,	2.23517e-14,	1.49012e-16,	7.05719e-11], 
[6.18617e+06,	61860.7,	618.253,	16.6589,	0.000467936,	0.000477473,	7.47681e-06,	3.46979e-07,	1.09959e-09,	1.33514e-11,	1.27157e-16]
], 
[
[38.2529,	-1,	1.43386e+09,	1.43311e+09,	-1,	4.94195e+07,	687857,	5607.56,	259.77,	75.5058,	562667], 
[-1,	0.379118,	1.43386e+07,	7499.31,	1.35886e+07,	872999,	6879,	56.5068,	0.254942,	0.254942,	5625.68], 
[9.55907e+08,	-1,	-1,	-1,	-1,	8730.48,	67.7763,	0.311302,	0.0127981,	0.0016222,	19.1198], 
[-1,	-1,	32.8306,	-1,	-1,	87.7998,	0.18278,	0.00148842,	1.69277e-05,	1.69277e-05,	0.0490417], 
[9.22577e+08,	-1,	-1,	-1,	-1,	1.373,	0.0134314,	0.000155136,	1.69873e-06,	2.08616e-07,	0.000785828], 
[1.13249e+08,	3.10481e+06,	11325.4,	113.749,	1.12939,	0.0472209,	0.000174321,	6.46338e-07,	1.86265e-08,	7.45058e-09,	9.34601e-05], 
[776972,	19642.5,	78.1979,	0.0936583,	0.0143025,	0.000121494,	6.37554e-06,	5.7742e-09,	3.72529e-11,	7.45058e-11,	2.86102e-07], 
[6110.48,	75.6168,	0.259148,	0.000960668,	3.77893e-05,	1.2219e-06,	7.61201e-09,	4.84288e-11,	1.11759e-12,	0,	5.34058e-09], 
[25.8353,	2.97364,	0.0140398,	5.75781e-05,	7.05322e-07,	1.49012e-08,	2.48353e-11,	4.96705e-13,	1.86265e-14,	7.45058e-15,	1.71661e-11], 
[1,	0.503295,	0.00831191,	1.69277e-05,	3.97364e-08,	5.96046e-16,	4.96705e-11,	7.45058e-16,	2.98023e-16,	1.49012e-16,	9.15527e-13], 
[19074.5,	191.735,	12.4441,	0.0749359,	0.000295003,	1.81198e-05,	5.08626e-08,	1.49409e-09,	9.53674e-13,	3.62396e-13,	1.90735e-14]
], 
[
[-1,	-1,	2.02779e+11,	2.02778e+11,	7.49969e+07,	7.5e+09,	2.21599e+10,	2.05848e+08,	3.55482e+06,	11921.9,	19072.5], 
[-1,	-1,	-1,	2.02778e+09,	749968,	7.5e+07,	2.21599e+08,	2.05848e+06,	35547.2,	120.209,	189.735], 
[-1,	-1,	-1,	1.43386e+07,	1.43311e+07,	749999,	1.88695e+06,	20534,	218.107,	0.907349,	0.907349], 
[330606,	9.55907e+08,	-1,	-1,	-1,	-1,	8730.48,	343.414,	2.43051,	0.0156631,	0.00135803], 
[3.33309e+07,	333308,	-1,	95558.2,	0.249957,	1359.36,	222.099,	1.55346,	0.00150108,	9.53674e-07,	7.24792e-05], 
[1.31853e+11,	1.31853e+09,	-1,	-1,	-1,	14.0886,	4.25525,	0.000276089,	0.000255823,	4.05312e-06,	9.53674e-07], 
[2.19642e+09,	2.19642e+07,	1.13249e+06,	16293.4,	162.439,	1.12939,	0.00164732,	0.000101643,	3.46899e-06,	4.52995e-08,	9.53674e-09], 
[1.96428e+08,	1.96428e+06,	21476.3,	78.1983,	1.27698,	0.0143026,	1.76605e-05,	2.26374e-06,	2.1863e-08,	1.43051e-10,	9.53674e-11], 
[611942,	6120.41,	472.592,	0.25885,	0.000960668,	9.93411e-05,	3.96252e-06,	2.1553e-08,	4.86374e-11,	2.6226e-12,	0], 
[15895.6,	159.946,	1.70208,	0.00182088,	0.000295003,	6.35783e-07,	1.58946e-09,	2.70208e-10,	2.22524e-12,	9.05991e-14,	9.53674e-15], 
[1,	1,	0.271566,	0.00182088,	8.64665e-05,	6.35783e-07,	6.35783e-09,	1.90735e-16,	6.35783e-13,	6.35783e-15,	5.72205e-16]
]];

const prognosed_relative_error = [[ // changes from -14 to 12
[2.97268e-14,	2.72308e-11,	2.07235e-07,	0.00207264,	-1,	-1,	29802.3,	-1,	2.43335e+08,	1.99304e+10,	2.85336e+12], 
[4.43369e-12,	8.93355e-13,	1.30867e-09,	8.92678e-06,	0.0855498,	224.161,	32190.2,	2.98023e+06,	-1,	-1,	2.85336e+12], 
[5.26304e-08,	3.35637e-10,	8.25857e-11,	9.66295e-08,	0.000999305,	11.8436,	32190.2,	2.11991e+06,	2.98023e+08,	-1,	3.21902e+12], 
[0.000477015,	3.08049e-06,	3.08998e-08,	9.75782e-09,	9.28077e-06,	0.0999223,	1110.22,	3.21902e+06,	2.58096e+08,	2.98023e+10,	2.24161e+12], 
[2.29418,	0.0275046,	0.000263201,	2.97505e-06,	9.02056e-07,	0.00122347,	8.88264,	85118.1,	3.10192e+08,	2.11991e+10,	1.99304e+12], 
[-1,	256.498,	3.0704,	0.0329003,	0.000333067,	9.10383e-05,	0.111271,	888.194,	8.14128e+06,	2.11533e+10,	2.85336e+12], 
[21460.1,	22941.8,	18598,	350.89,	3.72836,	0.0335376,	0.00909495,	10.7866,	85119.4,	9.9925e+08,	2.85336e+12], 
[1.32869e+06,	1.90224e+06,	-1,	1.79124e+06,	26316.9,	274.158,	2.74667,	0.982254,	814.907,	9.62228e+06,	9.99286e+10], 
[1.41328e+08,	1.41328e+08,	-1,	1.41328e+08,	1.8598e+08,	2.74136e+06,	27418.1,	331.784,	88.4756,	118762,	8.51173e+08], 
[1.81371e+10,	1.51746e+10,	1.62223e+10,	1.14709e+10,	1.81371e+10,	2.22133e+10,	2.52203e+08,	2.52232e+06,	40829.2,	9536.74,	9.25064e+06], 
[-1,	-1,	-1,	-1,	2.06795e+12,	-1,	2.50003e+12,	2.96066e+10,	3.07045e+08,	3.4523e+06,	820160]
], 
[
[1.06706e-12,	3.30872e-13,	1.13714e-09,	8.30817e-06,	0.0944425,	149.012,	11208,	-1,	1.21667e+08,	-1,	1.42668e+12], 
[2.09552e-13,	3.52379e-14,	2.35687e-11,	1.92427e-07,	0.00192487,	2.11533,	298.023,	22416.1,	2.11991e+06,	2.85336e+08,	2.85336e+10], 
[3.6246e-10,	4.43634e-12,	8.89385e-13,	1.04897e-09,	9.29933e-06,	0.107867,	310.192,	22416.1,	-1,	2.98023e+08,	3.21902e+10], 
[3.27845e-06,	4.60488e-08,	3.08998e-10,	1.02999e-10,	1.0391e-07,	0.00107334,	10.3632,	29802.3,	2.43335e+06,	-1,	2.24161e+10], 
[0.023741,	0.000345419,	2.86065e-06,	2.56739e-08,	9.71445e-09,	1.08136e-05,	0.103621,	888.238,	2.72057e+06,	-1,	1.99304e+10], 
[-1,	2.22133,	0.0330059,	0.000318034,	3.21965e-06,	8.43769e-07,	0.00100471,	9.62245,	88827.1,	2.98023e+08,	2.85336e+10], 
[-1,	190.224,	168.891,	3.0704,	0.0350894,	0.000297007,	9.09495e-05,	0.0896762,	888.226,	9.99286e+06,	2.85336e+10], 
[689316,	20679.5,	19022.4,	25000.3,	285.098,	2.63208,	0.0308319,	0.0109139,	8.14907,	103626,	9.99286e+08], 
[6.04571e+07,	-1,	-1,	1.81371e+06,	2.43335e+06,	29606.4,	274.181,	3.31784,	0.884756,	1043.08,	8.51173e+06], 
[5.73546e+09,	-1,	1.81371e+08,	1.62223e+08,	1.14709e+08,	1.72064e+08,	2.41237e+06,	21932.3,	397.861,	95.3674,	92506.4], 
[-1,	-1,	-1,	-1,	2.06795e+10,	-1,	2.50003e+10,	2.96066e+08,	3.07045e+06,	34523,	8201.6]
], 
[
[1.06874e-08,	4.8175e-11,	3.70577e-11,	1.00356e-07,	0.000925397,	10.3678,	-1,	1.36028e+06,	-1,	-1,	1.36028e+12], 
[4.49986e-11,	1.30496e-12,	3.59989e-13,	8.7075e-10,	1.01961e-05,	0.120859,	-1,	-1,	-1,	1.42668e+08,	1.36028e+10], 
[1.62348e-11,	1.90582e-13,	3.81165e-14,	1.91633e-11,	1.85031e-07,	0.00222101,	2.72057,	285.336,	-1,	-1,	2.24161e+08], 
[3.29326e-08,	3.18033e-10,	5.70561e-12,	1.02999e-12,	1.00961e-09,	1.19027e-05,	0.0929889,	-1,	25809.6,	2.98023e+06,	3.21902e+08], 
[0.000285189,	2.93914e-06,	3.61837e-08,	2.77556e-10,	1.04083e-10,	1.07692e-07,	0.00103636,	9.62294,	21199.1,	2.98023e+06,	-1], 
[3.40017,	0.0339193,	0.000444103,	3.191e-06,	3.45279e-08,	9.32587e-09,	1.04308e-05,	0.0888213,	888.271,	3.10192e+06,	-1], 
[7153.38,	57.3546,	2.14601,	0.0319056,	0.000318025,	3.72324e-06,	9.09495e-07,	0.000893124,	8.14209,	96225.8,	2.24161e+08], 
[689316,	6893.16,	-1,	250.003,	2.4124,	0.0263208,	0.000311047,	9.82254e-05,	0.0819564,	925.228,	1.03632e+07], 
[3.34198e+07,	-1,	18137.1,	-1,	24333.5,	296.064,	2.63203,	0.0334112,	0.00884756,	10.3712,	85121.2], 
[6.04571e+09,	3.82364e+07,	1.81371e+06,	-1,	1.90224e+06,	1.72064e+06,	20833.9,	219.353,	3.51667,	0.953674,	925.064], 
[-1,	-1,	-1,	-1,	1.41328e+08,	2.06795e+08,	1.79124e+08,	3.07024e+06,	30704.5,	288.963,	82.016]
], 
[
[0.000123361,	3.58871e-07,	4.03188e-09,	3.93023e-09,	9.28077e-06,	0.107324,	962.438,	1.36028e+06,	-1,	1.49012e+10,	1.42668e+12], 
[3.8968e-07,	1.19215e-08,	4.87891e-11,	3.93023e-11,	1.00094e-07,	0.00111048,	9.62438,	14901.2,	-1,	1.55096e+08,	1.42668e+10], 
[4.83373e-09,	4.49492e-11,	1.35186e-12,	3.93023e-13,	8.70831e-10,	1.09514e-05,	0.0944425,	112.08,	13602.8,	-1,	1.1208e+08], 
[1.53595e-09,	1.49078e-11,	1.6263e-13,	3.10353e-14,	1.69309e-11,	2.29432e-07,	0.00177681,	2.11991,	272.057,	31019.2,	3.10192e+06], 
[2.74375e-06,	2.41416e-08,	2.94903e-10,	3.93782e-12,	1.00614e-12,	1.08136e-09,	1.00422e-05,	0.107863,	298.023,	-1,	-1], 
[0.0307036,	0.000318097,	3.39136e-06,	4.60532e-08,	3.53051e-10,	8.88178e-11,	1.07576e-07,	0.000925265,	7.40171,	22416.1,	-1], 
[307.021,	2.63317,	0.0316558,	0.000493452,	3.19062e-06,	4.09273e-08,	8.52651e-09,	1.1496e-05,	0.0851206,	999.286,	3.10192e+06], 
[689316,	6340.79,	63.4079,	2.06795,	0.0264049,	0.000285127,	2.98314e-06,	1.12777e-06,	0.000708969,	9.99227,	111026], 
[6.04571e+07,	604571,	-1,	-1,	185.98,	2.96077,	0.025226,	0.000311993,	8.84756e-05,	0.111759,	1110.31], 
[6.04571e+09,	6.34079e+07,	604571,	-1,	-1,	22213.3,	241.238,	2.19323,	0.0375509,	0.00953674,	11.1389], 
[4.71092e+11,	4.71092e+09,	7.15338e+07,	1.81371e+06,	1.98682e+06,	-1,	2.56498e+06,	27413.6,	296.068,	2.77519,	0.858307]
], 
[
[0.536503,	0.00331164,	3.4276e-05,	4.42354e-07,	3.20924e-07,	0.00118683,	8.88214,	111067,	-1,	-1,	1.42668e+12], 
[0.00333969,	9.45804e-05,	2.62247e-07,	3.92481e-09,	3.55618e-09,	1.18572e-05,	0.0999194,	925.215,	1.36028e+06,	-1,	1.42668e+10], 
[3.29063e-05,	3.61834e-07,	9.86472e-09,	3.77302e-11,	3.64292e-11,	1.14686e-07,	0.000888377,	9.99528,	12166.7,	-1,	9.96518e+07], 
[3.98986e-07,	3.87422e-09,	3.93204e-11,	1.11456e-12,	3.29597e-13,	1.21014e-09,	1.05737e-05,	0.101951,	136.028,	11208,	1.36028e+06], 
[1.56125e-07,	1.56125e-09,	1.4456e-11,	1.61908e-13,	3.17454e-14,	2.50133e-11,	2.07233e-07,	0.00177654,	2.72057,	-1,	-1], 
[0.000330476,	3.41209e-06,	3.19374e-08,	3.63043e-10,	4.90719e-12,	9.10383e-13,	1.04308e-09,	8.92687e-06,	0.0892743,	310.192,	28533.6], 
[3.0703,	0.0285108,	0.000329067,	3.16533e-06,	5.42755e-08,	3.65219e-10,	9.09495e-11,	9.31323e-08,	0.000777224,	9.9925,	31019.2], 
[28512.9,	241.263,	3.07122,	0.0316535,	0.000427644,	2.64054e-06,	2.874e-08,	1.12777e-08,	7.83475e-06,	0.118428,	962.294], 
[-1,	662274,	-1,	47.1092,	1.57247,	0.0264049,	0.000252225,	3.31784e-06,	8.14907e-07,	0.0011161,	9.99279], 
[5.73546e+09,	6.34079e+07,	382364,	-1,	181.371,	229.418,	2.19314,	0.0252217,	0.000376999,	9.53674e-05,	0.111389], 
[-1,	-1,	6.34079e+07,	604571,	13286.9,	20679.5,	25000.3,	274.133,	2.8512,	0.0284195,	0.0082016]
], 
[
[35.3319,	46.4694,	0.411223,	0.00424938,	4.41314e-05,	4.32987e-05,	0.103739,	962.227,	8.88535e+06,	1.42668e+10,	1.42668e+12], 
[44.8362,	0.555333,	0.00413954,	4.11254e-05,	4.44089e-07,	4.10783e-07,	0.00103952,	7.77172,	74022.7,	-1,	1.42668e+10], 
[0.424967,	0.00431377,	0.000123363,	4.27824e-07,	5.16254e-09,	4.10783e-09,	1.03881e-05,	0.107324,	851.45,	-1,	-1], 
[0.00424975,	4.11264e-05,	4.31414e-07,	1.31528e-08,	4.52416e-11,	4.10783e-11,	9.24416e-08,	0.000925411,	7.77411,	-1,	996518], 
[4.31137e-05,	3.94129e-07,	4.42239e-09,	4.36688e-11,	1.50158e-12,	4.32987e-13,	8.69704e-10,	1.09513e-05,	0.0755481,	99.6518,	14266.8], 
[1.88738e-05,	1.92439e-07,	1.73935e-09,	1.81336e-11,	2.07242e-13,	2.77556e-14,	2.13589e-11,	1.70228e-07,	0.00177681,	2.24161,	-1], 
[0.0307902,	0.000285638,	3.41061e-06,	3.07902e-08,	3.18323e-10,	5.40012e-12,	9.09495e-13,	1.0059e-09,	9.29821e-06,	0.10415,	310.192], 
[285.105,	2.85102,	0.0263174,	0.00026325,	3.16525e-06,	4.27635e-08,	3.00133e-10,	1.12777e-10,	8.57981e-08,	0.000888288,	9.25299], 
[2.52238e+06,	27418.9,	274.153,	2.74262,	0.0271316,	0.000411213,	2.64065e-06,	2.78233e-08,	8.84756e-09,	9.65595e-06,	0.085125], 
[5.40744e+09,	5.73546e+07,	604571,	6045.71,	38.2364,	2.06795,	0.0264049,	0.000252247,	3.30806e-06,	1.01328e-06,	0.000930786], 
[6.89316e+11,	6.89316e+09,	6.89316e+07,	662274,	4428.97,	198.682,	185.98,	2.96073,	0.0296116,	0.000321388,	8.2016e-05]
], 
[
[5365.03,	5365.03,	4879.62,	45.2316,	0.397691,	0.00405009,	0.00412115,	10.0135,	85120,	9.62437e+08,	1.42668e+12], 
[3576.69,	53.6503,	38.1618,	0.411225,	0.00438689,	4.583e-05,	3.55271e-05,	0.107411,	777.195,	9.99381e+06,	1.42668e+10], 
[4779.55,	49.6705,	0.536503,	0.00413955,	4.25011e-05,	4.583e-07,	3.69482e-07,	0.00100044,	9.25211,	99952.9,	1.42668e+08], 
[41.1197,	0.383843,	0.00403545,	0.000123363,	4.00213e-07,	4.65405e-09,	3.83693e-09,	1.07593e-05,	0.0851194,	999.381,	1.55096e+06], 
[0.383835,	0.00383835,	3.83859e-05,	3.89662e-07,	1.02766e-08,	4.79616e-11,	4.26326e-11,	1.03955e-07,	0.000888371,	11.1051,	9965.18], 
[0.00431063,	4.68958e-05,	4.02641e-07,	4.02641e-09,	5.2817e-11,	1.5099e-12,	4.54747e-13,	1.02136e-09,	9.44105e-06,	0.109553,	155.096], 
[0.00137372,	1.7053e-05,	1.61056e-07,	1.51582e-09,	1.65793e-11,	1.75267e-13,	3.16902e-14,	2.06455e-11,	1.62825e-07,	0.00199876,	2.85336], 
[2.86188,	0.0243138,	0.000286491,	2.75577e-06,	3.07409e-08,	2.95586e-10,	4.27463e-12,	1.12777e-12,	8.9407e-10,	9.6707e-06,	0.0929959], 
[27414.3,	274.139,	2.41247,	0.025221,	0.000285198,	2.60014e-06,	3.78268e-08,	2.89874e-10,	8.3819e-11,	1.1906e-07,	0.000962257], 
[2.41263e+08,	1.97397e+06,	20835.7,	219.33,	2.3038,	0.0293967,	0.000361852,	2.31028e-06,	4.05312e-08,	9.23872e-09,	1.00517e-05], 
[6.34079e+11,	6.34079e+09,	6.62274e+07,	-1,	6893.16,	52.4156,	1.98682,	0.0319056,	0.000230312,	3.11852e-06,	8.39233e-07]
], 
[
[-1,	-1,	373601,	331299,	3289.57,	38.3807,	0.322871,	0.354703,	854.488,	9.62235e+06,	9.99381e+10], 
[317039,	3321.73,	4755.59,	3401.15,	32.8957,	0.356499,	0.00457021,	0.00336513,	7.78819,	92521.3,	9.99381e+08], 
[286773,	-1,	33.2173,	35.5199,	0.38381,	0.00356408,	4.3201e-05,	3.72893e-05,	0.0704313,	925.235,	8.14249e+06], 
[448362,	3527.71,	42.7496,	0.516987,	0.00344964,	3.15299e-05,	4.29736e-07,	3.45608e-07,	0.00074273,	9.25228,	88840.4], 
[3563.7,	35.637,	0.342715,	0.00333968,	0.000115138,	3.58864e-07,	3.75167e-09,	3.81988e-09,	8.89995e-06,	0.103622,	925.489], 
[37.0119,	0.356461,	0.00383837,	3.56461e-05,	3.47942e-07,	1.15094e-08,	3.79714e-11,	3.45608e-11,	9.28994e-08,	0.00085137,	10.3693], 
[0.347124,	0.0035925,	3.92599e-05,	4.80516e-07,	4.33526e-09,	4.06241e-11,	1.30967e-12,	3.81988e-13,	9.07457e-10,	9.44108e-06,	0.0944425], 
[0.139456,	0.00151582,	1.57646e-05,	1.51582e-07,	1.45519e-09,	1.51582e-11,	1.87962e-13,	3.29237e-14,	1.69966e-11,	1.92432e-07,	0.00199935], 
[297.247,	2.75516,	0.0296471,	0.000275516,	2.8677e-06,	2.8677e-08,	2.83665e-10,	4.08618e-12,	8.84756e-13,	1.11759e-09,	1.11586e-05], 
[2.3028e+06,	17544.9,	230.28,	2.52207,	0.0296064,	0.000230345,	2.48705e-06,	3.6183e-08,	4.11272e-10,	9.83477e-11,	1.11008e-07], 
[2.96125e+10,	2.96125e+08,	2.52221e+06,	27413.5,	296.086,	2.633,	0.0327875,	0.000444102,	2.86093e-06,	2.97546e-08,	7.82013e-09]
], 
[
[4.96705e+07,	3.53319e+07,	4.96705e+07,	3.53319e+07,	3.58945e+07,	383782,	3426.98,	39.2902,	34.9246,	100061,	1.22126e+09], 
[-1,	-1,	-1,	-1,	398743,	3563.7,	37.0113,	0.407454,	0.337604,	927.597,	1.11025e+07], 
[-1,	-1,	3533.19,	4967.05,	3987.43,	30.1544,	0.342727,	0.00407454,	0.00360887,	10.401,	92521.7], 
[-1,	-1,	3576.69,	49.6705,	37.5481,	0.32898,	0.00383792,	4.19095e-05,	3.14321e-05,	0.100136,	1036.23], 
[4.58438e+07,	362847,	4584.38,	36.2847,	0.536503,	0.00317368,	3.8385e-05,	3.66708e-07,	3.25963e-07,	0.00096336,	8.88195], 
[287837,	3700.75,	31.5255,	0.370134,	0.00333968,	0.0001028,	3.31231e-07,	3.95812e-09,	3.25963e-09,	8.91834e-06,	0.103624], 
[2879.14,	34.2746,	0.370143,	0.0032897,	3.56464e-05,	3.61799e-07,	9.86591e-09,	3.92902e-11,	3.25963e-11,	9.64105e-08,	0.000888405], 
[40.3573,	0.384171,	0.00347306,	3.74469e-05,	3.72529e-07,	3.62828e-09,	3.39545e-11,	1.46974e-12,	3.49246e-13,	1.06022e-09,	1.13291e-05], 
[12.4176,	0.135818,	0.0015522,	1.5134e-05,	1.5522e-07,	1.5134e-09,	1.47459e-11,	1.5134e-13,	2.61934e-14,	2.35587e-11,	1.92432e-07], 
[25257.5,	197.44,	2.42641,	0.025332,	0.000263005,	2.41647e-06,	2.63999e-08,	2.27491e-10,	5.87851e-12,	9.83477e-13,	1.04904e-09], 
[2.85104e+08,	2.85104e+06,	26317,	285.107,	2.85101,	0.0219323,	0.000263255,	2.71311e-06,	4.93422e-08,	3.31879e-10,	8.58307e-11]
], 
[
[4.53428e+09,	-1,	4.30159e+09,	4.30159e+09,	-1,	2.44882e+09,	2.87838e+07,	287946,	4842.88,	3278.26,	1.03951e+07], 
[-1,	4.05558e+07,	4.75559e+07,	4.30159e+07,	4.53428e+07,	3.55199e+07,	246718,	2604.91,	47.6837,	32.0375,	107574], 
[3.02285e+09,	-1,	-1,	-1,	-1,	366906,	2741.31,	26.051,	0.465661,	0.305474,	964.165], 
[-1,	-1,	286773,	-1,	-1,	3238.16,	28.7838,	0.28789,	0.00454485,	0.00327826,	10.0136], 
[3.02285e+09,	-1,	-1,	-1,	-1,	34.3332,	0.301562,	0.00287965,	4.61936e-05,	2.98023e-05,	0.103664], 
[4.48362e+09,	4.27496e+07,	313175,	3131.75,	43.8053,	0.430159,	0.00317366,	2.87909e-05,	5.21541e-07,	3.27826e-07,	0.000964165], 
[3.01543e+07,	274134,	2604.23,	27.4132,	0.315297,	0.00236561,	9.04645e-05,	2.76044e-07,	5.1409e-09,	3.12924e-09,	1.00231e-05], 
[301612,	3015.62,	27.4181,	0.287853,	0.00274181,	2.60522e-05,	2.92299e-07,	9.04333e-09,	5.17815e-11,	3.12924e-11,	1.0767e-07], 
[5215.41,	48.1804,	0.47187,	0.00454485,	4.52002e-05,	4.27167e-07,	4.84288e-09,	5.33958e-11,	1.57766e-12,	3.35276e-13,	1.05858e-09], 
[1539.79,	15.8946,	0.173847,	0.0016888,	1.93715e-05,	1.73847e-07,	1.58946e-09,	1.49012e-11,	1.88748e-13,	3.35276e-14,	2.13432e-11], 
[3.07401e+06,	30740.1,	296.275,	3.08673,	0.0296593,	0.00034078,	2.64168e-06,	2.75612e-08,	2.9405e-10,	5.07355e-12,	8.2016e-13]
], 
[
[-1,	-1,	5.16987e+11,	5.36503e+11,	3.53319e+11,	3.32173e+11,	3.89868e+11,	4.11197e+09,	3.01695e+07,	452995,	371933], 
[-1,	-1,	-1,	5.36503e+09,	3.53319e+09,	3.32173e+09,	3.89868e+09,	4.11197e+07,	301695,	4529.95,	3719.33], 
[-1,	-1,	-1,	3.73601e+07,	4.75559e+07,	4.96705e+07,	3.43332e+07,	342664,	3700.97,	39.1006,	38.147], 
[3.02285e+11,	2.21448e+09,	-1,	-1,	-1,	-1,	351522,	3974.88,	37.0121,	0.395775,	0.371933], 
[3.31137e+11,	3.31137e+09,	-1,	344658,	4755.59,	5169.87,	4011.34,	28.7838,	0.356436,	0.00419617,	0.00362396], 
[3.31137e+11,	3.31137e+09,	-1,	-1,	-1,	51.6987,	33.9374,	0.328978,	0.00411153,	3.48091e-05,	3.71933e-05], 
[4.38053e+11,	4.38053e+09,	3.91829e+07,	352771,	4380.53,	46.8298,	0.555333,	0.00358761,	3.56412e-05,	4.05312e-07,	3.71933e-07], 
[3.56372e+09,	3.56372e+07,	328956,	3563.72,	38.3785,	0.397552,	0.00333968,	0.000119248,	3.45039e-07,	4.76837e-09,	3.62396e-09], 
[4.1124e+07,	411240,	3975.07,	38.3838,	0.356452,	0.00397555,	2.87898e-05,	3.75779e-07,	1.10979e-08,	4.33922e-11,	3.8147e-11], 
[418027,	4180.27,	44.3459,	0.344912,	0.00376701,	3.71933e-05,	4.02133e-07,	4.59353e-09,	3.94185e-11,	1.27316e-12,	3.91006e-13], 
[158946,	1589.46,	15.8946,	0.158946,	0.00152588,	1.58946e-05,	1.58946e-07,	1.65304e-09,	1.58946e-11,	1.58946e-13,	3.07083e-14]
]];

// uncomment this if you want to check the exponential range of a table
//var max_e = 0;
//var min_e = 100;
//
//for(var i1 = 0; i1 <= 10; ++i1)
//for(var i2 = 0; i2 <= 10; ++i2)
//for(var i3 = 0; i3 <= 10; ++i3)
//    {
//    var x = prognosed_relative_error[i1][i2][i3];
//    if(x <= 0.0) continue;
//    var e = Math.log10(x);
//    if(e < min_e)
//        min_e = e;
//    if(e > max_e)
//        max_e = e;
//    }
//alert(Math.floor(min_e));
//alert(Math.floor(max_e));


// images
const zero_x = 175.5;
const zero_y = 450.5;
const dx = 36;
const dy = -24;
const dzx = -10;
const dzy = -15;

function n_from_x_y(x, y) {
    var n;
    if (x > zero_x)
        n = (y - zero_y) / dy;
    else 
        n = (y - (x - zero_x) * (dzy/dzx) - zero_y) / dy;
    n = Math.floor(n);
    if(n < 0)
        return 0;
    if(n > 10) 
        return 10
    return n;
}

function x_to_RRGGBB1(x) {
    if (x < 0.0)
        return "#666666";
    var e = Math.floor( Math.log10(x) );
    var t01 = (e + 16.0) / (12.0 + 16.0);
    return as_RRGGBB(Math.sin(t01 * 1.6), Math.cos(t01 * 1.4) * 0.8, 0.3);
}

function x_to_RRGGBB2(x) {
    if (x < 0.0)
        return "#444444";
    var e = Math.floor( Math.log10(x) );
    var t01 = (e + 16.0) / (12.0 + 16.0);
    return as_RRGGBB(Math.sin(t01 * 1.6) * 0.8, Math.cos(t01 * 1.4) * 0.7, 0.2);
}

function x_to_RRGGBB3(x) {
    if (x < 0.0)
        return "#222222";
    var e = Math.floor( Math.log10(x) );
    var t01 = (e + 16.0) / (12.0 + 16.0);
    return as_RRGGBB(Math.sin(t01 * 1.6) * 0.6, Math.cos(t01 * 1.4) * 0.6, 0.1);
}

// real error image
var real_error_n = 10;

function init_real_error() {
    var real_error = document.getElementById("real_error");
    var canvas_rect = real_error.getBoundingClientRect();
    real_error_draw(0, 0, false);

    real_error.addEventListener('mousemove', function(e){
        var canvas_rect = real_error.getBoundingClientRect();
        real_error_draw(e.clientX - canvas_rect.left, e.clientY - canvas_rect.top, true);
        if(e.buttons == 1){
           real_error_n = n_from_x_y(e.clientX - canvas_rect.left, e.clientY - canvas_rect.top);
           real_error_draw(e.clientX - canvas_rect.left, e.clientY - canvas_rect.top, false); // double work
        }
    }, false);

    real_error.addEventListener('mousedown', function(e){
        var canvas_rect = real_error.getBoundingClientRect();
        real_error_n = n_from_x_y(e.clientX - canvas_rect.left, e.clientY - canvas_rect.top);
        real_error_draw(e.clientX - canvas_rect.left, e.clientY - canvas_rect.top, false);
    }, false);

    real_error.addEventListener('mouseleave', function(e){
        real_error_draw(0, 0, false);
    }, false);
}

function real_error_draw(client_x, client_y, do_guides) {
    var real_error = document.getElementById("real_error");
    var real_error_context = real_error.getContext("2d");
    // background
    real_error_context.fillStyle="#eeeeee";
    real_error_context.fillRect(0, 0, 640, 538);
    
    
    for(var i1 = 0; i1 <= 10; ++i1) {
        for(var i2 = 0; i2 <= 10; ++i2) {
            for(var i3 = 0; i3 <= 10; ++i3) {
                if(i3 > real_error_n)
                    break;
                    
                var x = zero_x + dx * i1 + dzx * i2;
                var y = zero_y + dy * i3 + dzy * i2;
                // front
                if(i2 == 0) {
                    real_error_context.fillStyle = x_to_RRGGBB1(real_relative_error[i1][i2][i3]);
                    real_error_context.beginPath();                
                    real_error_context.moveTo(x, y);
                    real_error_context.lineTo(x + dx, y);
                    real_error_context.lineTo(x + dx, y + dy);
                    real_error_context.lineTo(x, y + dy);
                    real_error_context.lineTo(x, y);
                    real_error_context.fill();
                    real_error_context.closePath();
                }
                // left
                if(i1 == 0) {
                    real_error_context.fillStyle = x_to_RRGGBB2(real_relative_error[i1][i2][i3]);
                    real_error_context.beginPath();                
                    real_error_context.moveTo(x, y);
                    real_error_context.lineTo(x + dzx, y + dzy);
                    real_error_context.lineTo(x + dzx, y + dzy + dy);
                    real_error_context.lineTo(x, y + dy);
                    real_error_context.lineTo(x, y);
                    real_error_context.fill();
                    real_error_context.closePath();
                }
                // top
                if(i3 == real_error_n) {
                    real_error_context.fillStyle = x_to_RRGGBB3(real_relative_error[i1][i2][i3]);
                    real_error_context.beginPath();                
                    real_error_context.moveTo(x, y + dy);
                    real_error_context.lineTo(x + dzx, y + dzy + dy);
                    real_error_context.lineTo(x + dzx + dx, y + dzy + dy);
                    real_error_context.lineTo(x + dx, y + dy);
                    real_error_context.lineTo(x, y + dy);
                    real_error_context.fill();
                    real_error_context.closePath();
                }
            }
        }
    }
    // grid
    real_error_context.beginPath();
    real_error_context.strokeStyle="#000000";
    real_error_context.fillStyle="#000000";
    real_error_context.font = "16px sans-serif";
    real_error_context.textAlign = "center";
    real_error_context.textBaseline = "middle"; 
    // right
    real_error_context.moveTo(zero_x, zero_y);
    real_error_context.lineTo(zero_x + dx * 11, zero_y);
    real_error_context.lineTo(zero_x + dx * 11 - dx*0.8, zero_y - dy*0.2);
    real_error_context.moveTo(zero_x + dx * 11, zero_y);
    real_error_context.lineTo(zero_x + dx * 11 - dx*0.8, zero_y + dy*0.2);
    for(var i = -10; i <= 10; i += 4) {
        var x = zero_x + dx * (i + 10 + 1) / 2;
        var y = zero_y + 12;
        real_error_context.fillText("e" + i, x, y);
    }

    // up
    real_error_context.moveTo(zero_x, zero_y);
    real_error_context.lineTo(zero_x, zero_y + dy*11);
    real_error_context.lineTo(zero_x - dx*0.2, zero_y  + dy*11 - dy*0.8);
    real_error_context.moveTo(zero_x, zero_y + dy*11);
    real_error_context.lineTo(zero_x + dx*0.2, zero_y  + dy*11 - dy*0.8);
    for(var i = -6; i <= 10; i += 4) {
        var x = zero_x - 22;
        var y = zero_y + dy * (i + 10 + 1) / 2;
        real_error_context.fillText("e" + i, x, y);
    }
    
    // away
    real_error_context.moveTo(zero_x, zero_y);
    real_error_context.lineTo(zero_x + dzx*11, zero_y + dzy*11);
    real_error_context.lineTo(zero_x + dzx*11 - dzx*0.8 - dzy*0.2, zero_y + dzy*11 - dzy*0.8 + dzx * 0.2);
    real_error_context.lineTo(zero_x + dzx*11, zero_y + dzy*11);
    real_error_context.lineTo(zero_x + dzx*11 - dzx*0.8 + dzy*0.2, zero_y + dzy*11 - dzy*0.8 - dzx * 0.2);
    for(var i = -6; i <= 10; i += 4) {
        var x = zero_x + dzx * (i + 10 + 1) / 2 - 20;
        var y = zero_y + dzy * (i + 10 + 1) / 2 + 8;
        real_error_context.fillText("e" + i, x, y);
    }
        
    real_error_context.stroke();
    real_error_context.closePath();
     
    
    // legend
    var legend_dx = 640 / (16 + 12 + 1);
    var legend_dy = 24;
    for(var i = -16; i <= 12; ++i) {
        real_error_context.fillStyle = x_to_RRGGBB1(Math.pow(10, i));
        real_error_context.fillRect((16 + i) * legend_dx, 538 - legend_dy, legend_dx, legend_dy);
    }
    
    real_error_context.fillStyle="#000000";    
    for(var i = -14; i <= 10; i += 4) {
        var x = (16 + i + 0.5) * legend_dx;
        var y = 538 - legend_dy * 0.5;
        real_error_context.fillText("e" + i, x, y);
    }
}

// prognosed error image
var prognosed_error_n = 10;

function init_prognosed_error() {
    var prognosed_error = document.getElementById("prognosed_error");
    var canvas_rect = prognosed_error.getBoundingClientRect();
    prognosed_error_draw(0, 0, false);

    prognosed_error.addEventListener('mousemove', function(e){
        var canvas_rect = prognosed_error.getBoundingClientRect();
        prognosed_error_draw(e.clientX - canvas_rect.left, e.clientY - canvas_rect.top, true);
        if(e.buttons == 1){
           prognosed_error_n = n_from_x_y(e.clientX - canvas_rect.left, e.clientY - canvas_rect.top);
           prognosed_error_draw(e.clientX - canvas_rect.left, e.clientY - canvas_rect.top, false); // double work
        }
    }, false);

    prognosed_error.addEventListener('mousedown', function(e){
        var canvas_rect = prognosed_error.getBoundingClientRect();
        prognosed_error_n = n_from_x_y(e.clientX - canvas_rect.left, e.clientY - canvas_rect.top);
        prognosed_error_draw(e.clientX - canvas_rect.left, e.clientY - canvas_rect.top, false);
    }, false);

    prognosed_error.addEventListener('mouseleave', function(e){
        prognosed_error_draw(0, 0, false);
    }, false);
}

function prognosed_error_draw(client_x, client_y, do_guides) {
    var prognosed_error = document.getElementById("prognosed_error");
    var prognosed_error_context = prognosed_error.getContext("2d");
    // background
    prognosed_error_context.fillStyle="#eeeeee";
    prognosed_error_context.fillRect(0, 0, 640, 538);
    
    
    for(var i1 = 0; i1 <= 10; ++i1) {
        for(var i2 = 0; i2 <= 10; ++i2) {
            for(var i3 = 0; i3 <= 10; ++i3) {
                if(i3 > prognosed_error_n)
                    break;
                    
                var x = zero_x + dx * i1 + dzx * i2;
                var y = zero_y + dy * i3 + dzy * i2;
                // front
                if(i2 == 0) {
                    prognosed_error_context.fillStyle = x_to_RRGGBB1(prognosed_relative_error[i1][i2][i3]);
                    prognosed_error_context.beginPath();                
                    prognosed_error_context.moveTo(x, y);
                    prognosed_error_context.lineTo(x + dx, y);
                    prognosed_error_context.lineTo(x + dx, y + dy);
                    prognosed_error_context.lineTo(x, y + dy);
                    prognosed_error_context.lineTo(x, y);
                    prognosed_error_context.fill();
                    prognosed_error_context.closePath();
                }
                // left
                if(i1 == 0) {
                    prognosed_error_context.fillStyle = x_to_RRGGBB2(prognosed_relative_error[i1][i2][i3]);
                    prognosed_error_context.beginPath();                
                    prognosed_error_context.moveTo(x, y);
                    prognosed_error_context.lineTo(x + dzx, y + dzy);
                    prognosed_error_context.lineTo(x + dzx, y + dzy + dy);
                    prognosed_error_context.lineTo(x, y + dy);
                    prognosed_error_context.lineTo(x, y);
                    prognosed_error_context.fill();
                    prognosed_error_context.closePath();
                }
                // top
                if(i3 == prognosed_error_n) {
                    prognosed_error_context.fillStyle = x_to_RRGGBB3(prognosed_relative_error[i1][i2][i3]);
                    prognosed_error_context.beginPath();                
                    prognosed_error_context.moveTo(x, y + dy);
                    prognosed_error_context.lineTo(x + dzx, y + dzy + dy);
                    prognosed_error_context.lineTo(x + dzx + dx, y + dzy + dy);
                    prognosed_error_context.lineTo(x + dx, y + dy);
                    prognosed_error_context.lineTo(x, y + dy);
                    prognosed_error_context.fill();
                    prognosed_error_context.closePath();
                }
            }
        }
    }
    // grid
    prognosed_error_context.beginPath();
    prognosed_error_context.strokeStyle="#000000";
    prognosed_error_context.fillStyle="#000000";
    prognosed_error_context.font = "16px sans-serif";
    prognosed_error_context.textAlign = "center";
    prognosed_error_context.textBaseline = "middle"; 
    // right
    prognosed_error_context.moveTo(zero_x, zero_y);
    prognosed_error_context.lineTo(zero_x + dx * 11, zero_y);
    prognosed_error_context.lineTo(zero_x + dx * 11 - dx*0.8, zero_y - dy*0.2);
    prognosed_error_context.moveTo(zero_x + dx * 11, zero_y);
    prognosed_error_context.lineTo(zero_x + dx * 11 - dx*0.8, zero_y + dy*0.2);
    for(var i = -10; i <= 10; i += 4) {
        var x = zero_x + dx * (i + 10 + 1) / 2;
        var y = zero_y + 12;
        prognosed_error_context.fillText("e" + i, x, y);
    }

    // up
    prognosed_error_context.moveTo(zero_x, zero_y);
    prognosed_error_context.lineTo(zero_x, zero_y + dy*11);
    prognosed_error_context.lineTo(zero_x - dx*0.2, zero_y  + dy*11 - dy*0.8);
    prognosed_error_context.moveTo(zero_x, zero_y + dy*11);
    prognosed_error_context.lineTo(zero_x + dx*0.2, zero_y  + dy*11 - dy*0.8);
    for(var i = -6; i <= 10; i += 4) {
        var x = zero_x - 22;
        var y = zero_y + dy * (i + 10 + 1) / 2;
        prognosed_error_context.fillText("e" + i, x, y);
    }
    
    // away
    prognosed_error_context.moveTo(zero_x, zero_y);
    prognosed_error_context.lineTo(zero_x + dzx*11, zero_y + dzy*11);
    prognosed_error_context.lineTo(zero_x + dzx*11 - dzx*0.8 - dzy*0.2, zero_y + dzy*11 - dzy*0.8 + dzx * 0.2);
    prognosed_error_context.lineTo(zero_x + dzx*11, zero_y + dzy*11);
    prognosed_error_context.lineTo(zero_x + dzx*11 - dzx*0.8 + dzy*0.2, zero_y + dzy*11 - dzy*0.8 - dzx * 0.2);
    for(var i = -6; i <= 10; i += 4) {
        var x = zero_x + dzx * (i + 10 + 1) / 2 - 20;
        var y = zero_y + dzy * (i + 10 + 1) / 2 + 8;
        prognosed_error_context.fillText("e" + i, x, y);
    }
        
    prognosed_error_context.stroke();
    prognosed_error_context.closePath();
     
    
    // legend
    var legend_dx = 640 / (16 + 12 + 1);
    var legend_dy = 24;
    for(var i = -16; i <= 12; ++i) {
        prognosed_error_context.fillStyle = x_to_RRGGBB1(Math.pow(10, i));
        prognosed_error_context.fillRect((16 + i) * legend_dx, 538 - legend_dy, legend_dx, legend_dy);
    }
    
    prognosed_error_context.fillStyle="#000000";    
    for(var i = -14; i <= 10; i += 4) {
        var x = (16 + i + 0.5) * legend_dx;
        var y = 538 - legend_dy * 0.5;
        prognosed_error_context.fillText("e" + i, x, y);
    }
}

function show(n){
    document.getElementById("shown_" + n).style.display = "none";
    document.getElementById("hidden_" + n).style.display = "inline";
}
    </script>
  </head>
  <body>
    <center>
    <h1>
Estimating floating point error the easy way
    </h1>
    <p>
I hope we can all agree: floating point numbers are not real. They are just fancy integers that can't make up their mind.
    </p>
    <p>
Let me elaborate on this. For a contrast, here is a 6-bit <b>fixed point</b> number. It's basically an integer number of quarters.
    </p>
    <canvas id="fixed" width=640 height=200></canvas>
    <p class="comment">
Bit cells are, of course, clickable.
    </p>
    <p>
It is simple, and it has simple limitations. You can't have numbers less than 0.25, and you can't have numbers greater than 7.75.
    </p>
    <p>
And here is a 6-bit <b>floating point</b> number:
    </p>
    <canvas id="floating" width=640 height=200></canvas>
    <p>
The 6-bit fixed point number covers positive numbers only from 0.25 to 7.25<span id="shown_sidenote_1" onclick="show('sidenote_1')"><u>*</u></span><span id="hidden_sidenote_1" style="display:none">, and, of course, negative numbers from -7.25 to -0.25, and 0, but this is not important</span>, while the 6-bit floating point number covers the same subset from 0.25 to 56. It looks like the latter has a larger range, but it actually covers fewer real numbers than the former because the last part of its range covers no real numbers at all.
    </p>
    <table>
    <tr><th>Binary</th><th>Fixed point</th><th>Floating point</th></th> 
    <tr><td>000001</td><td>0.25</td><td>0.25</td></tr>
    <tr><td>000010</td><td>0.50</td><td>0.5</td></tr>
    <tr><td>000011</td><td>0.75</td><td>0.75</td></tr>
    <tr><td>000100</td><td>1.00</td><td>1</td></tr>
    <tr><td>000101</td><td>1.25</td><td>1.25</td></tr>
    <tr><td>000110</td><td>1.50</td><td>1.5</td></tr>
    <tr><td>000111</td><td>1.75</td><td>1.75</td></tr>
    <tr><td>001000</td><td>2.00</td><td>2</td></tr>
    <tr><td>001001</td><td>2.25</td><td>2.5</td></tr>
    <tr><td>001010</td><td>2.50</td><td>3</td></tr>
    <tr><td>001011</td><td>2.75</td><td>3.5</td></tr>
    <tr><td>001100</td><td>3.00</td><td>4</td></tr>
    <tr><td>001101</td><td>3.25</td><td>5</td></tr>
    <tr><td>001110</td><td>3.50</td><td>6</td></tr>
    <tr><td>001111</td><td>3.75</td><td>7</td></tr>
    <tr><td>010000</td><td>4.00</td><td>8</td></tr>
    <tr><td>010001</td><td>4.25</td><td>10</td></tr>
    <tr><td>010010</td><td>4.50</td><td>12</td></tr>
    <tr><td>010011</td><td>4.75</td><td>14</td></tr>
    <tr><td>010100</td><td>5.00</td><td>16</td></tr>
    <tr><td>010101</td><td>5.25</td><td>20</td></tr>
    <tr><td>010110</td><td>5.50</td><td>24</td></tr>
    <tr><td>010111</td><td>5.75</td><td>28</td></tr>
    <tr><td>011000</td><td>6.00</td><td>32</td></tr>
    <tr><td>011001</td><td>6.25</td><td>40</td></tr>
    <tr><td>011010</td><td>6.50</td><td>48</td></tr>    
    <tr><td>011011</td><td>6.75</td><td>56</td></tr>
    <tr><td>011100</td><td>7.00</td><td>positive infinite</td></tr>
    <tr><td>011101</td><td>7.25</td><td>not a number</td></tr>
    <tr><td>011110</td><td>7.50</td><td>not a number</td></tr>
    <tr><td>011111</td><td>7.75</td><td>not a number</td></tr>
    </table>
    <p>
With fixed point numbers we can add 4.00 and 0.25 and get 4.25. But in floating point numbers the next number is 5, so 4 + 0.25 = ... 4. And that's how we lose precision constantly. A bit here and a bit there. All because our floating point numbers are not real numbers, and not even a decent model of the real numbers. It's just a collection of real numbers that plays by its own rules.
    </p>
    <p>
Rule number one: the computational error is imminent<span id="shown_sidenote_3" onclick="show('sidenote_3')"><u>*</u></span><span id="hidden_sidenote_3" style="display:none">. Although, techincally you can concienciously operate within the small safe subset of numbers and operations. 2 + 2 is still 4. But this is quite another story</span>.
    </p>
    <p>
The common misconception is in practice we have enough bits to make this error negligible. Well, the problem with this point of view is that quite often it's true. But really is it true or not depends on these three things:
    <ol>
    <li>The stability of the operation.</li>
    <li>The ranges of variables involved.</li>
    <li>How much error can we tolerate?</li>
    </ol>
    <p>
So, obviously enough, it can't be true all the time. And it isn't. In computational geometry, this is the source of the most unpleasant bugs. The ones that come and go. The once that don't reproduce on unit-tests and lay low through the integration phase only to stab you in the back as soon as you turn around to do other things.
    </p>
    <p>
How to protect yourself from this threat? Engineering has one ultimate answer for this kind of questions and it's: measurement!
    </p>
    
    <h2>
Measuring the floating point error using an inverse operation
    </h2>
    <p>
For example, let's take a <a href="https://github.com/akalenuk/wordsandbuttons/blob/master/drafts/floating_point_surrealismmeter/double_interval/cubic_solver.hpp">cubic equation solver</a>. It is surprisingly computationally rich. Full of multiple multiplications, trigonometry, and square roots. But the inverse operation for solving a cubic equation, getting the coefficients from the given roots, is very simple. 
    </p>
    <table>
    <tr><td>
ax<sup>3</sup> + bx<sup>3</sup> + cx + d = 0
    </td></tr><tr><td>
(x - x<sub>1</sub>)(x - x<sub>2</sub>)(x - x<sub>3</sub>) = 0
    </td></tr><tr><td>
a = 1
    </td></tr><tr><td>
b = x<sub>1</sub> + x<sub>2</sub> + x<sub>3</sub>
    </td></tr><tr><td>
c = x<sub>1</sub>x<sub>2</sub> + x<sub>2</sub>x<sub>3</sub> + x<sub>3</sub>x<sub>1</sub>
    </td></tr><tr><td>
d = x<sub>1</sub>x<sub>2</sub>x<sub>3</sub>
    </td></tr>
    </table>
    <p>
This means that we can measure the error of solving a cubic equation for every 3 roots we want. Yes, it will also have an error of the coefficients computation, but this error should be small enough to be considered a negligible error of error measurement<span id="shown_sidenote_2" onclick="show('sidenote_2')"><u>*</u></span><span id="hidden_sidenote_2" style="display:none">, which probably deserves a measurement on it's own, but let's just skip this part and evade a stack overflow</span>.
    </p>
    <p>
Let's do an <a href="https://github.com/akalenuk/wordsandbuttons/blob/master/drafts/floating_point_surrealismmeter/double_interval/exp_2.cpp">experiment</a>. Let's measure the relative error for a triplet of roots defined in some exponential range.
    </p>
    <table>
    <tr><td>
x<sub>1</sub> = 1*10<sup>i<sub>1</sub></sup>, x<sub>2</sub> = 2*10<sup>i<sub>2</sub></sup>, x<sub>3</sub> = 3*10<sup>i<sub>3</sub></sup>,
    </td></tr><tr><td>
i<sub>1</sub> = -10, -8,... 10,
    </td></tr><tr><td>
i<sub>2</sub> = -10, -8,... 10,
    </td></tr><tr><td>
i<sub>3</sub> = -10, -8,... 10.
    </td></tr>
    </table>
    <p>
We get a 3D grid of errors for different configurations of roots' orders of magnitude. Here it is. You can click on it to see what's inside of every particular layer.
    </p>
    <canvas id="real_error" width=640 height=538></canvas>
    <p class="comment">
Click on the front side or on the left side of the cube.
    </p>
    <p>
The black cells are where the algorithm failed to find all three roots. The red ones are the ones with the largest error, and the green ones are the ones with the least error. All and all, the error changes from e<sup>-16</sup> to e<sup>12</sup>. Remember, this is relative error, so e<sup>12</sup> for a root of e<sup>10</sup> is actually an enormous number that looks like this: 10'000'000'000'000'000'000'000. That's our worse error.
    </p>
    <p>
Do you see the pattern here? The green area shoots through the diagonal. This means that it's all good when the orders of the roots are roughly the same. Whether they are e<sup>-8</sup> or e<sup>2</sup> or e<sup>+10</sup>. It's all fine as long as there is no significant difference. But when there is, he have trouble. 
    </p>
    <p>
I once had a really nasty bug that eventually boiled down to the equation with one root being exactly 600, and the other two at about 2e-5. I had to track it down, and, of course, it really helped me to have the error measured. But it also became an eye-opening experience because these are not astronomical numbers. That's... really visible quantities. It's like 2 cents and 600'000 euros in one equation. Not even millions.
    </p>
    <p>
So here is a trivial advice: when in doubtmeasure. When not in doubtmeasure and be surprised.
    </p>
    <h2>
Estimating the floating point error using intervals
    </h2>
    <p>
What if we don't have a reverse operation at all? Or what if it introduces the greater error than the operation itself? It's problematic to calculate computational error when we don't have a reliable way to obtain the ground truth. Can we know the error without the actual measuring?
    </p>
    <p>
Well, no. But we can still do some estimate without measuring an actual error, there is a way for that.
    </p>
    <p>
Let's get back to our 6-bit numbers. Remember, we couldn't add 4 and 0.25 properly because 6-bit float only have 4 and 5? Now, what if we represent a real number not as a nearest value from available, but as an interval of available values written in a more powerful subset? And we'll then operate on the intervals, doing sums and square roots, so when the error grows, we'll see that. Sounds promising, right? 
    </p>
    <p>
For instance, in our intervals, 4.25 is now something between 4 and 5. If we sum it with 2.25 (which is inbetween 2 and 2.5), we will not get 6 and some error, we will get an interval from 6 to 7.5. It's ok, we can have 7.5 since we store interval in larger numbers, not 6-bits. Our real result is 6.5, and our real error in 6-bit numbers is 0.5. But what we get instead is interval 1.5 wide, so we can presume that the resulting value is not 6 with some unknown error, but 6.75 with 0.75 error. 
    </p>
    <p>
This way we can measure how the difference between the real numbers and their floating point representation accumulates through the calculation. We measure not the actual error, but the width of the interval that definitely holds our value that itself may not be necessary represented in floating point numbers.
    </p>
    <p>
Unless our algorithm is ultimately stable, operating on intervals make them larger and larger, and the size of each interval subsequently represents the potential error we might face. Of course, out real error should be smaller than that, so measuring interval sizes doesn't substitute the exact measurements, like what we did in the previous experiment. But this is an estimation, and for our cubic solver, <a href="https://github.com/akalenuk/wordsandbuttons/blob/master/drafts/floating_point_surrealismmeter/double_interval/exp_3.cpp">the estimation</a> actually follows the measured numbers rather well.
    </p>
    <canvas id="prognosed_error" width=640 height=538></canvas>    
    <script language="JavaScript">
        init_fixed();
        init_floating();
        init_real_error();
        init_prognosed_error();
    </script>
    <p>
The great thing about this approach is that you don't have to rewrite all your code to work on intervals instead of floats only to get these estimates. For instance, in C++ you can make <a href="https://github.com/akalenuk/wordsandbuttons/blob/master/drafts/floating_point_surrealismmeter/double_interval/double_interval.hpp">an interval representing type</a> disguise itself as a double with a simple #define. Yes, it's a dirty hack, and you have to be careful to have all your maths functions reimplemented for the intervals, but it has its perks.
    </p>
    <p>
First of all, it's simple. You do <a href="https://github.com/akalenuk/wordsandbuttons/blob/master/drafts/floating_point_surrealismmeter/double_interval/exp_1.cpp">something like this</a>: 
    </p>
    <table style="border: 1px solid black;font-style: normal;">
    <tr><td><pre>
#include "double_interval.hpp"

#define double DoubleInterval
#include "cubic_solver.hpp"

...
    </pre></td></tr>
    </table>
    <p>
And all your doubles acquire <i>from</i> and <i>to</i> fields automatically. You just run your tests then and check the intervals. Simple!
    </p>
    <p>
Second, it's more pessimistic than the measurements. And in a good way too. The measurements go for a real error, intervals estimate the worse case. Since you can't measure the error for all the possible input, some imprecision is expected anyway. It's better to have it more on the pessimistic side.
    </p>
    <p>
Third, it enables you to do what almost nobody does but almost everybody should. It enables you to debug a computational error. You can see it, you can trace the execution to find the source of it, you can make the code better. Sometimes, it's as easy as to normalize some vector just one extra time.
    </p>
    <h2>
Conclusion
    </h2>
    <p>
Floating point computational error is measurable and manageable. By measuring it you can make your clients happy, and yourselffree from the nights of fruitless debugging. Yes, the tools for this are not that popular as debuggers or profilers, and the methodology is not very well established. But is it really the reason not to measure it at all?
    </p>
    <h2>
P. S.
    </h2>
    <p>
All the <a href="https://github.com/akalenuk/wordsandbuttons">source code</a> for this site is hosted on GitHub. Particularly, the experiments described along with the cubic solver and the double interval class are available here:
<br>
<a href="https://github.com/akalenuk/wordsandbuttons/tree/master/drafts/floating_point_surrealismmeter/double_interval">.../drafts/floating_point_surrealismmeter/double_interval</a>. 
    </p>

    <p class="footer">
    <a class="twitter-share-button"
  href="https://twitter.com/intent/tweet?text=How+to+predict+the+floating+point+computational+error+without+actual+measurements&url=http://wordsandbuttons.online/surrealismmeter_for_floating_point_numbers.html&hashtags=computation,error,cpp&via=wordsandbuttons"
  data-size="large">
Tweet</a>
    <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
    <br>     
There are more words and buttons on <a href="index.html">wordsandbuttons.online</a>.
    </p>
    </center>
  </body>
</html>
